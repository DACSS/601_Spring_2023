{
  "hash": "5cd61b04086e64f42b7b6cb797d55825",
  "result": {
    "markdown": "---\ntitle: \"Final Project: Tim Shores\"\nauthor: \"Tim Shores\"\ndescription: \"Project & Data Description\"\ndate: \"05/20/2023\"\nformat:\n  html:\n    df-print: paged\n    toc: true\n    code-copy: true\n    code-tools: true\n    code-fold: true\n    code-overflow: wrap\n    css: styles.css\ncategories:\n  - final_Project\neditor_options: \n  chunk_output_type: console\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_packages <- c(\"tidyverse\", \"fs\", \"pdftools\", \"knitr\", \"ggplot2\", \"viridis\", \"hrbrthemes\", \"gridExtra\") # create vector of packages\ninvisible(lapply(my_packages, require, character.only = TRUE)) # load multiple packages\n\nknitr::opts_chunk$set(echo = TRUE, warning=FALSE, message=FALSE)\n```\n:::\n\n\n### Summary\n\nThis is the story of two small, rural Massachusetts towns that have made an agreement to combine their two local police departments into a single regionalized department. The goal of regionalization, initiated in 2020, is to reduce cost by sharing a service. However, regionalization has made it more challenging for the towns to assess personnel needs of their police and other public safety services. \n\nFor example, if demand for first responders has increased, is it because a single police department is now responding to calls from both towns, or is it for reasons unrelated to regionalization, such as increased police response to medical calls or other calls for which police response is not required?\n\nI intend to use the data collected to better inform budgeting and public safety discussion by public officials in the two towns. Furthermore, the work of regionalized municipal services is a common challenge that small rural towns, strapped for revenue, must consider. Improving how we collect and derive insights from municipal service regionalization data will be a vital service to towns who often don't have the capacity to organize their own data-driven policy and administration.\n\n::: {.callout-warning icon=false}\n\n## Research question\n\n**What is the nature of public safety need behind the increase in calls that police respond to?**\n\n:::\n\n\n### Background\n\nSince 2020, I have volunteered my time as a community organizer and political office-holder in the small rural town of Leverett, Massachusetts. Some of the key challenges of public administration in Leverett are a high property tax rate,   unaffordability, the needs of an aging population, lack of transportation, lack of access to commerce and health service, lack of access to public process, and lack of resources for gathering good evidence for public decision-making.\n\nAt the recent budget meetings in Spring 2023, the Leverett Police Chief made a budget request for a fourth full-time officer position. This position would help the Police Department overcome these problems:\n\n1. Decreased supply of police officer human resources due to state criminal justice reform.\n2. Increased demand for police officer human resources due to increased call volume in the towns of Leverett and Wendell.\n\n::: {.callout-tip icon=false}\n\n## Problem #1 in detail\n\n**How has state reform decreased supply of police officers?**\n\n:::\n\nSince 2021, state POST reform has made it [difficult for local police departments](https://www.berkshireeagle.com/news/central_berkshires/lenox-police-chief-talks-impact-of-new-rules-for-part-time-officers/article_3949b04c-35b2-11ec-8169-a72d6e4669a8.html) to fill their on-duty schedules with reserve police officers. Before 2021, reserve officers required half as much training as full-time officers. Reserve officers could work part-time and as a second job in seasonal positions or on shifts as-needed could do so with lower training requirements. The State of Massachusetts Peace Officer Standards and Training (POST) Commission has enacted a series of reforms that increased the amount of training required by reserve officers. Reserves must now train as much as full-time officers. This has removed an incentive and reduced the availability of reserve officers. Local police departments now struggle to meet their scheduling needs and turn to requests for more full-time positions.\n\n::: {.callout-tip icon=false}\n\n## Problem #2 in detail\n\n**How much and why has call volume increased in Leverett and Wendell?**\n\n:::\n\nSince 2020, when the Wendell chief of police retired, the neighboring towns of Leverett and Wendell have agreed to combine their municipal police service. Wendell closed its own police department (WPD), and began to allocate its police budget revenue to the Leverett Police Department (LPD). LPD took responsibility for responding to police and emergency calls from both Leverett and Wendell. This regionalization of municipal service is expected to reduce public safety costs over time, although in the short-term it appears that Leverett has paid for more police expenses compared to Wendell's share. Meanwhile, LPD is still adjusting to the change in demand for police service, which shows up as an increase in call volume that officers respond to.  \n\nTo solve these problems, Leverett Chief of Police Scott Minckler proposed that Leverett hire a fourth full-time officer. \n\nThe request was approved by the Leverett and Wendell Police Services Oversight committee, the Leverett Personnel Board, and the Leverett Finance Committee. When the matter came before the Leverett Selectboard budget meeting, some members of town government and the public wanted to know more detail about the increase in call volume. \n\n::: {.callout-tip icon=false}\n\n## Questions of public interest\n\na. What types of calls are increasing? \nb. What is the change in personnel time needed per call and per type of call?\nc. What days and times of day do we see the most calls or the most change in calls?\nd. Why do we need another officer when the populations and number of properties in the two towns have not grown substantially?\n\n:::\n\nChief Minckler's responses to these questions were informed by his administrative experience, but not by call data analysis. Due to difficulties generating reports from the administrative software used by many emergency response departments, the Chief was not able to use call data to do more than track call volume and call type. The Chief was not able to answer questions about the nature of increased calls: Were they violent crime, domestic violence, interpersonal conflict, fraud, property rights violations, traffic violations, medical emergencies, mental health emergencies, fires? \n\nAlthough people had multiple concerns and interests in the matter, most meeting participants had this basic question in common: \n\n::: {.callout-warning icon=false}\n\n## Research question\n\n**What is the nature of public safety need behind the increase in calls that police respond to?**\n\n:::\n\nIn other words, if we hire another police officer, will that meet the public safety need? If our increased needs are by nature medical, mental health, fire, or community health and well-being, then **we risk misallocating public resources in a solution to the wrong problem**.\n\n\n### Dataset Introduction\nTo collect data that could help understand more about the public safety need of Leverett and Wendell, I submitted this [public records request](https://www.mass.gov/info-details/massachusetts-law-about-freedom-of-information-and-public-records):\n\n::: {.callout-note icon=false}\n\n## Email to PD: Thu, Mar 30, 2023 at 3:00 PM\n\nSubject: Public Records Request for Leverett PD call data\nTo: Scott D. Minckler <policechief@leverett.ma.us>\n\nHi Chief Minckler,\n\nI also left a voicemail, but thought it would help to send my request by email. I've been learning about the budget requests from last week's meeting to get a sense of the request and the call volume and any other factors behind the request. It would help if I could learn more about our call data. \n\nI'm writing to request public data to do with Leverett and Wendell calls made to dispatch, and calls handled by our police department, for the 5-year period 2018 to 2022 (inclusive of the years 2018, 2019, 2020, 2021, and 2022). I'm requesting complete police department call detail records, with columns of data redacted if they are subject to specific statutory exemption to the MA Public Records Law due to criteria such as victim confidentiality. \n\nPlease export data from your call management software application to CSV or XLSX files, rather than PDF or Word documents. The tabular CSV or XLSX format will facilitate data analysis.  \n\nIf the export files are too large for email attachment, please upload to this Drive location: \n\n*url omitted*\n\nThanks! Let me know if you have any questions or feedback.\n\nTim Shores\n\n:::\n\nChief Minckler called me the following Monday morning to discuss the request. He could supply reports, but not at the level of detail that I requested. I learned more about the challenges of pulling reports. I also learned from Chief Minckler that one reason for the growth of calls in Wendell was that the former police chief of Wendell did not record every call. This was not made known at the time when the two towns negotiated their regionalization agreement. \n\nI spoke with Supervisor Butch Garrity of Shelburne Dispatch, which serves as the 911 dispatcher for most towns in Franklin County, including Leverett and Wendell. The dispatch center and local agencies have used a client-server application called [IMC-Central Square](https://www.centralsquare.com/) since 1997 to manage dispatch calls and responses. The application has a reputation for being difficult to use and limited in functionality.\n\n::: {.callout-warning icon=false}\n\n### IMC-Central Square report limitations\n\n1. The report export format was limited to PDF.\n2. They could only provide call summary data. It was not practical to provide call detail data that would include relevant information (such as call day and time of day, location, demographics of people involved, and details of actions taken by responding officers) because Central Square has no redaction functions. \n:::\n\nThese software limitations have come up before in Leverett. In 2020, the town of Leverett appointed residents to a Social Justice Committee (SJC). While researching a report on policing and the experience of people of color in Leverett, the SJC submitted multiple requests for police call data that included race and ethnicity of people involved in calls. LPD claimed that they were not able to comply because they were unable to generate reports for anything more detailed than than call volume grouped by call reason. The SJC met with someone at Amherst PD, which uses the same software, who offered to meet with LPD about how to generate IMC-Central Square reports. I am not aware of any follow-through on that offer for inter-departmental collaboration on the SJC public records request.\n\nBased on my career experience with numerous database systems, I'm confident that technical means exist to overcome these functional limits. However, I take the claims of the LPD and Shelburne Dispatch to be made in good faith. At the end of the day, it comes down to a lack of resources, and as a researcher I must set my expectations accordingly.\n\nChief Minckler sent me 10 PDF files: one for each town and year, from 2018 to 2022. Each file includes 3 tables:\n\n::: {.callout-note icon=false}\n\n## Source report structure\n\n1. **Call Reason Breakdown** shows the number of calls for each call reason, average time per call per call reason, and the type and number of actions taken in response to each call reason.\n2. **Call Action Breakdown** shows summaries of call actions.\n3. **Operator Race and Sex Breakdown** shows demographics of vehicle operators involved in traffic stops and violations.\n:::\n\n**Call Reason Breakdown** is the primary object of this analysis.\n\nI used the R libraries `purrr` and `pdf_tools` to read-in the data to a list of 10 lists of data frames: one data frame for each page, one list for each file, in a collection of 10 files.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprojectFiles <- dir_ls('../posts/TimShores_FinalProject_Data') # creates fs_path vector of each file in that directory\n\nprojectFiles_list <- projectFiles %>%\n  map(pdf_data) # purrr function that applies pdf_data reading function to each file element of fs_path vector\n  # map creates a list of lists of tibbles (a tibble for each page of each pdf)\n\n  # now that I've consumed my files I can str_replace to get town and year info from each filename.\n\nprojectFiles <- projectFiles %>% \n  str_replace('../posts/TimShores_FinalProject_Data/', '') %>%\n  str_replace('.pdf', '') \nnames(projectFiles_list) <- projectFiles\n```\n:::\n\n\nI took the following general steps to parse this list:\n\n::: {.callout-note icon=false}\n\n## Data transformation steps\n\n1. Mutated each row with information about the town, year, and source page number.\n2. Flattened the nested list of data frames into a single data frame of all observations that retained the horizontal and vertical arrangement of the tables in the source reports.\n3. When pdf_data reads a file, it parses each text box encoded in the PDF as a separate data frame row. It records x and y coordinates of each text box in a data frame variable. Given the regularity of horizontal and vertical alignment of tables in the Central Square report format, this made it possible to identify column boundaries: each column had a minimum and maximum value for x. I used `pivot_wider` to create new variables to temporarily store values based on their horizontal position on the page.\n4. The Call Reason Breakdown table in the source reports is a combination of call reasons (each call has a single reason) and call actions (each call has 0, 1, or many actions taken by officers). I focused most of my tidying and transformation steps to teasing apart Call Reason Breakdown observations into separate data frames: one for reasons, another for actions. The source data shows time variables in minutes -- I will convert these to hours.\n5. I created a third data frame for operator demographics, although the reports do not show how this data is related to calls.\n6. My code removed all NA values. Every observation in the original reports had values for every variable. However, because the Call Reason Breakdown table format staggers data about call reasons and actions, the initial data frame had many NAs. When plyering apart the semantics of reason and action, I interpret NA to indicate that I must remove the row or fill in the variable with a sub-heading value. The end result is three data frames with no NAs.\n:::\n\nSee my comments in the code block below for details.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n  # This next part took a couple days of searching for a tidy solution. \n  # Then I just decided to use a good old-fashioned nested for loop.\n  # The structure of the original documents is that each of 10 files has a variable number of pages.\n  # Therefore, the projectFiles_list structure is a nested list of dataframes: list[[list]][[dataframe]]. \n  # I want to mutate each df with the page number from its PDF, or \"innerpageid\". \n  # Inner pagination corresponds to each dataframe's nested list element index (j in list[[i]][[j]]) which \n  # is information that gets destroyed as soon as I map to an unnested list. I couldn't find a tidy solution to capturing that nested\n  # \"inner\" page id before the map, so I used a nested for loop to assign value to innerpageid before appending my mapped/mutated df to\n  # a new single-layer list.\n\nallYearsList <- list()\nfor (i in seq_along(projectFiles_list)) { # seq_along(projectFiles_list) creates vector with a number value for each list element\n  for (j in seq_along(projectFiles_list[[i]])) {\n    projectFiles_list[[i]][[j]] <- mutate(projectFiles_list[[i]][[j]], innerpageid = j)\n  }\n  allYearsList <- append(allYearsList, map2(projectFiles_list[[i]], \n                                            names(projectFiles_list[i]), \n                                            ~.x %>% \n                                              mutate(filename = .y)\n                                            )\n                         )\n  }\n\n  # this bind_rows takes all of the df observations from all of the list elements and binds them together in a single df.\n  # outerpageid is the 'page' number in an absolute sequence (1 to 78 in this case) rather than segmented by file (1 to 9, 1 to 7 etc.)\n  # Note that outerpageid is not particularly important (it's semantically identical to town, year, innerpageid) \n  # and I should remove this scaffold.\n\nallYearsDF <- allYearsList %>%\n  bind_rows(.id = 'outerpageid') %>% \n  relocate(c(filename, innerpageid), .after = outerpageid) %>%\n  filter(height == 11 & y > 13 & text != \"Action:\")\n  \n  # this creates a problem of staggered lines\n\nallYearsDF_wide <- allYearsDF %>% \n  pivot_wider(id_cols = c(outerpageid, filename, innerpageid, y), names_from = x, values_from = text)\n\n# solution from https://stackoverflow.com/questions/45515218/combine-rows-in-data-frame-containing-na-to-make-complete-row\n# Supply lists by splicing them into dots:\n\ncoalesce_by_column <- function(df) {\n  return(dplyr::coalesce(!!! as.list(df)))\n}\n\nallYearsDF_wide <- allYearsDF_wide %>%\n  mutate(outerpageid = as.integer(outerpageid))\n\nallYearsDF_wide <- allYearsDF_wide %>%\n  group_by(outerpageid, filename, innerpageid, y) %>% # outerpageid is redundant here\n  summarise_all(coalesce_by_column) %>%\n  ungroup()\n# do I need to ungroup() ? doesn't seem to hurt!\n\n  # it will help to order columns by numeric order - they are the x coords from left to right. This looks for all non-alpha column names.\n\nnumcols = sort(as.numeric(names(allYearsDF_wide)[!grepl(\"[a-z]\", names(allYearsDF_wide))]))\nallYearsDF_wide <- select(allYearsDF_wide, outerpageid, filename, innerpageid, y, match(numcols, names(allYearsDF_wide))) \n\n  # now we have a df that is simply x:y coordinates of the page\n  # time to smush cols together!\n\nallYearsDF_wide <- unite(allYearsDF_wide, \"x5to52\", c(\"5\":\"47\"), sep = \" \", na.rm = TRUE, remove = TRUE)\nallYearsDF_wide <- unite(allYearsDF_wide, \"x53to197\", c(\"53\":\"197\"), sep = \" \", na.rm = TRUE, remove = TRUE)\nallYearsDF_wide <- unite(allYearsDF_wide, \"x198to238\", c(\"198\":\"233\"), sep = \" \", na.rm = TRUE, remove = TRUE)\nallYearsDF_wide <- unite(allYearsDF_wide, \"x239to280\", c(\"239\":\"270\"), sep = \" \", na.rm = TRUE, remove = TRUE)\nallYearsDF_wide <- unite(allYearsDF_wide, \"x281to329\", c(\"281\":\"329\"), sep = \" \", na.rm = TRUE, remove = TRUE)\nallYearsDF_wide <- unite(allYearsDF_wide, \"x330to371\", c(\"330\":\"371\"), sep = \" \", na.rm = TRUE, remove = TRUE)\nallYearsDF_wide <- unite(allYearsDF_wide, \"x372to449\", c(\"372\":\"431\"), sep = \" \", na.rm = TRUE, remove = TRUE)\nallYearsDF_wide <- unite(allYearsDF_wide, \"x450toEnd\", c(\"450\":\"545\"), sep = \" \", na.rm = TRUE, remove = TRUE)\n\n  # note that spacing does differ on each page (as indicated by the colnames), but the boundaries are stable\n  # (as indicated by the united colnames -- I manually confirmed the minimum pixel position of each column on each data frame)\n\n  # final tidying of Call_Reason text separated into different columns\n\nallYearsDF_wide <- mutate(allYearsDF_wide, \n                          x5to52 = ifelse(nchar(x5to52, type=\"chars\") > 0 & nchar(x53to197, type=\"chars\") > 0, \n                                          paste0(x5to52,\" \",x53to197), \n                                          paste0(x5to52)),\n                          x53to197 = ifelse(nchar(x5to52, type=\"chars\") > 0, \n                                            paste0(\"\"), \n                                            paste0(x53to197))) # delete from additional columns\n\nallYearsDF_wide <- mutate(allYearsDF_wide, \n                          x53to197 = ifelse(x53to197 == \"\", paste0(\"\"), paste0(x53to197, \" \", x198to238, \" \", x239to280, \" \", x281to329, \" \", x330to371, \" \", x372to449, \" \", x450toEnd)),\n                          x198to238 = ifelse(nchar(x53to197, type=\"chars\") > 0, paste0(\"\"), paste0(x198to238)), # delete from add'l cols\n                          x239to280 = ifelse(nchar(x53to197, type=\"chars\") > 0, paste0(\"\"), paste0(x239to280)), # delete from add'l cols\n                          x281to329 = ifelse(nchar(x53to197, type=\"chars\") > 0, paste0(\"\"), paste0(x281to329)), # delete from add'l cols\n                          x330to371 = ifelse(nchar(x53to197, type=\"chars\") > 0, paste0(\"\"), paste0(x330to371)), # delete from add'l cols\n                          x372to449 = ifelse(nchar(x53to197, type=\"chars\") > 0, paste0(\"\"), paste0(x372to449)), # delete from add'l cols\n                          x450toEnd = ifelse(nchar(x53to197, type=\"chars\") > 0, paste0(\"\"), paste0(x450toEnd)) # delete from add'l cols\n                          )\n\nallYearsDF_wide <- allYearsDF_wide %>% mutate_at(c(5,6), ~na_if(., '')) # replace blanks with NAs in the 2nd and 3rd cols. I tried this using paste in the previous mutate, but the result was a text string \"NA\".\n\n  # label each action with its call reason\n\nallYearsDF_wide <- fill(allYearsDF_wide, x5to52, .direction = \"down\")\n\nallYearsDF_wide <- allYearsDF_wide %>% \n  mutate(x53to197 = ifelse(row_number() == 1, \"Action\", x53to197))\n\ncolnames(allYearsDF_wide)[-c(1:4)] <- allYearsDF_wide[1,-c(1:4)]\n\nallYearsDF_wide <- allYearsDF_wide %>% \n  rename_with(tolower) %>%\n  rename_with(~ gsub(\"._\", \"_\", .x, fixed = TRUE)) %>%\n  rename_with(~ gsub(\"@\", \"at\", .x, fixed = TRUE)) %>%\n  rename(avg_hours_to_arrive = avg_arrive,\n         avg_hours_at_scene = avg_time_at_scene) %>%\n  filter(innerpageid != 1 | y != 69 | call_reason != \"Call_Reason\") %>%\n  filter(self != \"Self_Init\") %>%\n    # sep filename into town and year\n  separate_wider_regex(filename, c(town = \"^[A-Za-z]+\", year = \"[0-9]{4}$\")) %>%\n  mutate(town = factor(town),\n         year = make_date(year = as.integer(year), month = 1, day = 1)) %>%\n  select(-c(total, \"___%\")) %>%\n  mutate(across(call_reason:avg_hours_at_scene, ~na_if(., \"\")))\n\n  # First and second df achievement unlocked:\n\ncallReasonsDF <- allYearsDF_wide %>% \n  filter(is.na(action)) %>% \n  filter(!is.na(self)) %>%\n  select(town, year, call_reason, self, disp, avg_hours_to_arrive, avg_hours_at_scene) %>%\n  mutate(call_reason = factor(call_reason)) %>%\n  mutate_at(c(\"self\", \"disp\"), as.integer) %>%\n  mutate_at(c(\"avg_hours_to_arrive\", \"avg_hours_at_scene\"), as.numeric) %>%\n  mutate(\n    avg_hours_to_arrive = ifelse(is.na(avg_hours_to_arrive), 0, avg_hours_to_arrive),\n    avg_hours_per_call = avg_hours_to_arrive + avg_hours_at_scene,\n    avg_hours_per_call = avg_hours_per_call / 60,    # convert times to hours\n    totalCalls = self + disp,\n    totalHours = totalCalls * avg_hours_per_call) %>%\n  select(-c(avg_hours_to_arrive, avg_hours_at_scene))\n\n  # keeps only rows with call_reason = TOTAL\ntotalReasonsDF <- callReasonsDF %>% \n  filter(grepl(\"^TOTAL$\", call_reason, ignore.case = FALSE))\n\n  # gets rid of rows with call_reason = TOTAL\ncallReasonsDF <- callReasonsDF %>%\n  filter(!grepl(\"total\", call_reason, ignore.case = TRUE))\n\n  # Third df achievement unlocked\n\ncallActionsDF <- allYearsDF_wide %>% \n  filter(!is.na(action)) %>%\n  filter(!grepl(\"total\", call_reason, ignore.case = TRUE)) %>%\n  select(c(town, year, call_reason, action))  %>%\n  separate_wider_regex(action, c(actionname = \".+\", \" = \", actioncount = \".*\")) %>%\n  mutate(call_reason = factor(call_reason),\n         actionname = factor(actionname),\n         actioncount = str_squish(actioncount),\n         actioncount = as.integer(actioncount))\n\n  # Fourth df achievement unlocked\n\ntotalActionsDF <- allYearsDF_wide %>%\n  filter(is.na(action), is.na(self)) %>%\n  filter(!grepl(\"total\", call_reason, ignore.case = TRUE)) %>%\n  select(c(town, year, call_reason, disp)) %>%\n  separate_wider_regex(call_reason, c(actionname = \"[A-Za-z/()\\\\-\\\\s]+\", self = \"\\\\s[0-9]{1,4}\", \".*\")) %>%\n  mutate(actionname = factor(actionname),\n         self = str_squish(self),\n         disp = str_squish(disp)) %>%\n  mutate_at(c(\"self\", \"disp\"), as.integer)\n\n  # Fifth and final df achievement unlocked\n\noperatorSummaryDF <- allYearsDF_wide %>% \n  filter(!is.na(action)) %>%\n  filter(grepl(\"total\", call_reason, ignore.case = TRUE)) %>%\n  mutate(opcategory = str_extract(action, \"Sex|Race|Ethnicity\")) %>%\n  fill(opcategory) %>%\n  filter(!grepl(\"total\", action, ignore.case = TRUE)) %>%\n  rename(opid = action) %>%\n  select(c(town, year, opcategory, opid))  %>%\n  separate_wider_regex(opid, c(opid = \"[A-Za-z/\\\\-\\\\s]+\", opcount = \"\\\\s[0-9]{1,3}\", \".+\")) %>%\n  mutate(opcategory = factor(opcategory),\n         opid = str_squish(opid),\n         opid = factor(opid),\n         opcount = str_squish(opcount),\n         opcount = as.integer(opcount))\n```\n:::\n\n\n\n### Data Dictionary\n\nThese are the final data frame variables: \n\n::: {.callout-note icon=false}\n\n## callReasonsDF\n\n- **call_reason**: factor with 121 levels, describes the type of incident that resulted in a call to LPD or Shelburne Dispatch\n- **self**: the number of calls per call_reason made directly to LPD (or WPD before 2021)\n- **disp**: the number of calls per call_reason made to Shelburne Dispatch\n- **avg_hours_per_call**: mean time in hours to work per call. \n:::\n\n::: {.callout-note icon=false}\n\n## totalReasonsDF\n\nFetches totals of numeric variables from the report. This is only for quality-assurance comparison with calculated totals of **callReasonsDF** variables.\n\n:::\n\n::: {.callout-note icon=false}\n\n## callActionsDF\n\n- **call_reason**: Factor with 121 levels, same as in callReasonsDF\n- **actionname**: Factor with 47 levels, one for each action outcome for a call\n- **actioncount**: Count of actionnames for each call_reason\n:::\n\n::: {.callout-note icon=false}\n\n## totalActionsDF\n\nFetches totals from the **Call Action Breakdown** table. This supports quality-assurance comparison with calculated totals of **callActionsDF** variables. However the **Call Action Breakdown** table also attributes action counts to calls directly to the local police department and to Shelburne Dispatch. This information is not available in the **Call Reason Breakdown** table.\n\n- **self**: Count of actionnames for calls made directly to LPD (or WPD before 2021).\n- **disp**: Count of actionnames for calls made to Shelburne Dispatch.\n\n:::\n\n::: {.callout-note icon=false}\n## operatorSummaryDF\n\n- **opcategory**: Factor with 3 levels: Ethnicity, Race, or Sex\n- **opid**: Factor with 11 levels corresponding to specific ethnicity, races, sexes\n- **opid**: Count of vehicle operators for each opid\n:::\n\n::: {.callout-note icon=false}\n\n## Key variables\n\nEach data frame includes the following variables that identify when and where the incident and response happened:\n\n- **town**: 2-level factor, Leverett or Wendell\n- **year**: date, 2018 to 2022 (in all cases, month = 1 and day = 1)\n\nI can join reason and action data by using town, year, and call_reason as a compound key.\n:::\n\nFinally, I created a dataframe of 11 \"public safety themes\" mapped to each of the 121 call reasons that I can use to analyze the dataset in simpler terms. This is my own subjective interpretation of public safety themes, and I will remain open to feedback and referrals to standard taxonomies, if any exist. One of the dilemmas of analyzing police data is a lack of clear policing data standards. \n\n::: {.callout-note icon=false}\n\n## Public safety themes\n\n- Administration\n- Fire\n- Medical\n- Mental Health or Social Work\n- Nonviolent Crime\n- Other Safety\n- Prevention\n- Utility\n- Vehicular\n- Violent Crime\n\n:::\n\nThe LPD call data does not show when police response is required. These themes permit interpretations of call volume and time according to when police response is required in comparison with the calls that a police officer responds to because another type of first responder is not available.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncallReasonNameFactors = c(\"209A SERVICE\", \"209A VIOLATION\", \"911 CALL\", \"911 HANG UP\", \"911 MIS DIAL\", \"911 Text to 911\", \"ABANDONED 911 CALL\", \"ABANDONED MV\", \"ADMINISTRATIVE\", \"ALARM BURGLAR OR HOLDUP\", \"ANIMAL COMPLAINT\", \"ANNOYING PHONE CALLS\", \"ARTICLES LOST\", \"ARTICLES RECOVERED\", \"ASSAULT\", \"ASSIST CITIZEN\", \"ASSIST OTHER AGENCY\", \"BE ON THE LOOK OUT\", \"BREAKING & ENTERING AUTO\", \"BREAKING & ENTERING PAST\", \"BREAKING AND ENTERING\", \"BRUSH FIRE\", \"BUILDING/LOCATION CHECK\", \"BURN/AGRI PERMIT\", \"BYLAW VIOLATION\", \"Car vs. Deer\", \"CARBON MONOXIDE HAZARD\", \"CHECK WELFARE\", \"CHIMNEY FIRE\", \"Civil Issue\", \"COMMUNITY POLICING\", \"COMPLAINT\", \"COURT\", \"CRUISER MAINTENANCE\", \"CSO FOLLOW UP\", \"CSO OUTREACH\", \"CUSTODY ISSUE\", \"DEATH\", \"DETAIL REQUEST\", \"DISABLED MV\", \"DISTURBANCE\", \"DOMESTIC\", \"Drill/Testing\", \"DRUG OFFENSE\", \"DRUNK\", \"EMS ALARM - LIFELINE ACTIVATED\", \"ESCORT/TRANSPORT\", \"EXPLOSION\", \"FIGHT\", \"FIRE ALARM\", \"FIRE WORKS\", \"FIRE, OTHER NON-SPECIFIC\", \"FIREARMS LICENSING\", \"FOLLOW UP INVESTIGATION\", \"FRAUD/SCAM\", \"GAS LEAK\", \"GENERAL INFO\", \"HARASSMENT\", \"HIT AND RUN\", \"ILLEGAL BURN\", \"ILLEGAL DUMPING\", \"INVESTIGATION\", \"JUVENILE OFFENSES\", \"KEEP THE PEACE\", \"LARCENY\", \"LINE DOWN, POWER,PHONE OR CABL\", \"LOCKOUT\", \"MEDICAL EMERGENCY\", \"MISCELLANEOUS\", \"MISSING PERSON\", \"MOTOR VEHICLE - STOLEN\", \"MOTOR VEHICLE ACCIDE W/INJURY\", \"MOTOR VEHICLE ACCIDENT NO INJU\", \"MOTOR VEHICLE COMPLAINT\", \"MOTOR VEHICLE RECOVERED\", \"MOTOR VEHICLE VIOLATION\", \"NOISE COMPLAINT\", \"NOTIFICATION\", \"ODOR INVESTIGATION\", \"OFFICER WANTED\", \"OPEN DOOR\", \"Paid Detail\", \"PAPERWORK SERVICE\", \"PARKING COMPLAINT\", \"PATROL AREA\", \"POWER OUTAGE/FAILURE\", \"RADAR/TRAFFIC ENFORCEMENT\", \"RAPE\", \"REPOSSESSION\", \"RESCUE CALL\", \"ROLLING 9\", \"ROLLING Q2-1\", \"RUNAWAY\", \"SAFETY HAZARD\", \"SCHOOL RESOURCE OFFICER DUTIES\", \"SEARCH\", \"Section 12\", \"SERVE WARRANT\", \"SERVICE CALL\", \"SEX OFFENDER REGISTRATION\", \"SHOPLIFTING\", \"SHOTS FIRED\", \"SMOKE INVESTIGATION\", \"SOLICITING\", \"STRUCTURE FIRE\", \"SUICIDE COMMITTED\", \"SUICIDE THREAT\", \"SUMMONS SERVICE\", \"SUSPICIOUS ACTIVITY\", \"SUSPICIOUS PACKAGE\", \"SUSPICIOUS PERSON\", \"SUSPICIOUS VEHICLE\", \"SWATTING\", \"THREAT\", \"TRAFFIC CONTROL\", \"TRAFFIC HAZARD\", \"TRESPASS\", \"TRUANT\", \"UNWANTED PERSON\", \"VANDALISM\", \"VEHICLE FIRE\")\n\ncallReasonNameThemes = c(\"Mental Health or Social Work\", \"Mental Health or Social Work\", \"Other Safety\", \"Administration\", \"Administration\", \"Administration\", \"Administration\", \"Vehicular\", \"Administration\", \"Violent Crime\", \"Other Safety\", \"Other Safety\", \"Other Safety\", \"Administration\", \"Violent Crime\", \"Other Safety\", \"Other Safety\", \"Other Safety\", \"Nonviolent Crime\", \"Nonviolent Crime\", \"Violent Crime\", \"Fire\", \"Prevention\", \"Fire\", \"Nonviolent Crime\", \"Vehicular\", \"Fire\", \"Prevention\", \"Fire\", \"Mental Health or Social Work\", \"Prevention\", \"Other Safety\", \"Administration\", \"Administration\", \"Mental Health or Social Work\", \"Mental Health or Social Work\", \"Mental Health or Social Work\", \"Other Safety\", \"Administration\", \"Vehicular\", \"Other Safety\", \"Violent Crime\", \"Administration\", \"Mental Health or Social Work\", \"Mental Health or Social Work\", \"Medical\", \"Other Safety\", \"Fire\", \"Violent Crime\", \"Fire\", \"Fire\", \"Fire\", \"Administration\", \"Administration\", \"Nonviolent Crime\", \"Utility\", \"Administration\", \"Nonviolent Crime\", \"Violent Crime\", \"Fire\", \"Nonviolent Crime\", \"Administration\", \"Mental Health or Social Work\", \"Prevention\", \"Nonviolent Crime\", \"Utility\", \"Other Safety\", \"Medical\", \"Other Safety\", \"Other Safety\", \"Nonviolent Crime\", \"Medical\", \"Vehicular\", \"Vehicular\", \"Vehicular\", \"Vehicular\", \"Nonviolent Crime\", \"Administration\", \"Other Safety\", \"Other Safety\", \"Prevention\", \"Administration\", \"Administration\", \"Vehicular\", \"Prevention\", \"Utility\", \"Vehicular\", \"Violent Crime\", \"Other Safety\", \"Other Safety\", \"Vehicular\", \"Vehicular\", \"Mental Health or Social Work\", \"Other Safety\", \"Administration\", \"Other Safety\", \"Mental Health or Social Work\", \"Administration\", \"Administration\", \"Prevention\", \"Nonviolent Crime\", \"Violent Crime\", \"Fire\", \"Nonviolent Crime\", \"Fire\", \"Mental Health or Social Work\", \"Mental Health or Social Work\", \"Administration\", \"Prevention\", \"Prevention\", \"Prevention\", \"Prevention\", \"Violent Crime\", \"Nonviolent Crime\", \"Vehicular\", \"Vehicular\", \"Nonviolent Crime\", \"Mental Health or Social Work\", \"Other Safety\", \"Nonviolent Crime\", \"Fire\")\n\nfactorThemesDF <- data.frame(call_reason = callReasonNameFactors, call_theme = callReasonNameThemes) %>%\n  mutate(call_reason = factor(call_reason),\n         call_theme = factor(call_theme))\n\ncallReasonsDF <- left_join(callReasonsDF, factorThemesDF, by ='call_reason')\ncallActionsDF <- left_join(callActionsDF, factorThemesDF, by ='call_reason')\n```\n:::\n\n\nTo get a sense of the scale of time spent on calls, these 3 tables show (1) a summary of time per call by the top 5 call reason mean times; (2) a summary of time per call by town; and (3) a summary of time per call by year.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#define function to calculate mode\nfind_mode <- function(x) {\n  u <- unique(x[!is.na(x)]) # unique list as an index, without NA\n  tab <- tabulate(match(x[!is.na(x)], u))  # count how many times each index member occurs\n  u[tab == max(tab)] #  the max occurrence is the mode\n  mean(u) # return mean in case the data is multimodal\n}\n\n\ncallReasonsDF_ReasonSummary <- callReasonsDF %>% \n  group_by(call_reason) %>% \n  summarise(\n    meanHrs = mean(avg_hours_per_call, na.rm = TRUE), \n    modeHrs = find_mode(avg_hours_per_call), \n    minHrs = fivenum(avg_hours_per_call, na.rm = TRUE)[1], \n    lHingeHrs = fivenum(avg_hours_per_call, na.rm = TRUE)[2], \n    medHrs = median(avg_hours_per_call, na.rm = TRUE), \n    uHingeHrs = fivenum(avg_hours_per_call, na.rm = TRUE)[4], \n    maxHrs = fivenum(avg_hours_per_call, na.rm = TRUE)[5]\n    ) %>%\n  arrange(desc(meanHrs))\n\ncrReasonRoundedDF <- callReasonsDF_ReasonSummary %>% \n  mutate_if(is.numeric, round, digits = 2)\nhead(crReasonRoundedDF, 5)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"call_reason\"],\"name\":[1],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"meanHrs\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"modeHrs\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"minHrs\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"lHingeHrs\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"medHrs\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"uHingeHrs\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"maxHrs\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"SUICIDE COMMITTED\",\"2\":\"3.14\",\"3\":\"3.14\",\"4\":\"2.40\",\"5\":\"2.40\",\"6\":\"3.14\",\"7\":\"3.89\",\"8\":\"3.89\"},{\"1\":\"DOMESTIC\",\"2\":\"2.40\",\"3\":\"2.40\",\"4\":\"1.36\",\"5\":\"1.39\",\"6\":\"2.31\",\"7\":\"2.82\",\"8\":\"4.14\"},{\"1\":\"STRUCTURE FIRE\",\"2\":\"2.12\",\"3\":\"2.12\",\"4\":\"0.83\",\"5\":\"1.16\",\"6\":\"1.48\",\"7\":\"2.77\",\"8\":\"4.06\"},{\"1\":\"DEATH\",\"2\":\"1.95\",\"3\":\"1.95\",\"4\":\"0.10\",\"5\":\"1.20\",\"6\":\"2.30\",\"7\":\"2.88\",\"8\":\"3.45\"},{\"1\":\"TRAFFIC HAZARD\",\"2\":\"1.67\",\"3\":\"1.86\",\"4\":\"0.00\",\"5\":\"0.25\",\"6\":\"0.45\",\"7\":\"0.55\",\"8\":\"13.49\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\ncallReasonsDF_TownSummary <- callReasonsDF %>% \n  group_by(town) %>% \n  summarise(\n    meanHrs = mean(avg_hours_per_call, na.rm = TRUE), \n    modeHrs = find_mode(avg_hours_per_call), \n    minHrs = fivenum(avg_hours_per_call, na.rm = TRUE)[1], \n    lHingeHrs = fivenum(avg_hours_per_call, na.rm = TRUE)[2], \n    medHrs = median(avg_hours_per_call, na.rm = TRUE), \n    uHingeHrs = fivenum(avg_hours_per_call, na.rm = TRUE)[4], \n    maxHrs = fivenum(avg_hours_per_call, na.rm = TRUE)[5]\n    ) %>%\n  arrange(desc(meanHrs))\n\ncrTownRoundedDF <- callReasonsDF_TownSummary %>% \n  mutate_if(is.numeric, round, digits = 2)\ncrTownRoundedDF\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"town\"],\"name\":[1],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"meanHrs\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"modeHrs\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"minHrs\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"lHingeHrs\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"medHrs\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"uHingeHrs\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"maxHrs\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"Leverett\",\"2\":\"0.50\",\"3\":\"0.54\",\"4\":\"0\",\"5\":\"0.21\",\"6\":\"0.4\",\"7\":\"0.63\",\"8\":\"4.14\"},{\"1\":\"Wendell\",\"2\":\"0.48\",\"3\":\"0.82\",\"4\":\"0\",\"5\":\"0.00\",\"6\":\"0.2\",\"7\":\"0.61\",\"8\":\"13.49\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\ncallReasonsDF_YearSummary <- callReasonsDF %>% \n  group_by(year) %>% \n  summarise(\n    meanHrs = mean(avg_hours_per_call, na.rm = TRUE), \n    modeHrs = find_mode(avg_hours_per_call), \n    minHrs = fivenum(avg_hours_per_call, na.rm = TRUE)[1], \n    lHingeHrs = fivenum(avg_hours_per_call, na.rm = TRUE)[2], \n    medHrs = median(avg_hours_per_call, na.rm = TRUE), \n    uHingeHrs = fivenum(avg_hours_per_call, na.rm = TRUE)[4], \n    maxHrs = fivenum(avg_hours_per_call, na.rm = TRUE)[5]\n    ) %>%\n  arrange(desc(meanHrs))\n\ncrYearRoundedDF <- callReasonsDF_YearSummary %>% \n  mutate_if(is.numeric, round, digits = 2)\ncrYearRoundedDF\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"year\"],\"name\":[1],\"type\":[\"date\"],\"align\":[\"right\"]},{\"label\":[\"meanHrs\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"modeHrs\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"minHrs\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"lHingeHrs\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"medHrs\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"uHingeHrs\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"maxHrs\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"2018-01-01\",\"2\":\"0.58\",\"3\":\"0.78\",\"4\":\"0\",\"5\":\"0.00\",\"6\":\"0.31\",\"7\":\"0.67\",\"8\":\"13.49\"},{\"1\":\"2020-01-01\",\"2\":\"0.58\",\"3\":\"0.75\",\"4\":\"0\",\"5\":\"0.05\",\"6\":\"0.41\",\"7\":\"0.70\",\"8\":\"4.85\"},{\"1\":\"2022-01-01\",\"2\":\"0.49\",\"3\":\"0.57\",\"4\":\"0\",\"5\":\"0.15\",\"6\":\"0.39\",\"7\":\"0.64\",\"8\":\"2.82\"},{\"1\":\"2021-01-01\",\"2\":\"0.45\",\"3\":\"0.52\",\"4\":\"0\",\"5\":\"0.17\",\"6\":\"0.39\",\"7\":\"0.63\",\"8\":\"2.69\"},{\"1\":\"2019-01-01\",\"2\":\"0.37\",\"3\":\"0.58\",\"4\":\"0\",\"5\":\"0.00\",\"6\":\"0.22\",\"7\":\"0.49\",\"8\":\"4.14\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n### Analysis Plan\n\nMy goal is to analyze and visualize call data in answer to this question: \n\n::: {.callout-warning icon=false}\n\n## Research question\n\n**What is the nature of public safety need behind the increase in calls that police respond to?**\n\n:::\n\nMy analysis plan is to answer the following more specific questions for both towns together, and compared between towns: \n\n::: {.callout-warning icon=false}\n\n## Specific questions for analysis\n\n1. Has the time spent doing police work grown over time?\n2. Leverett and Wendell began a regionalization agreement in 2020. How has that impacted the data of time spent on calls?\n3. What call reasons have grown over time?\n4. Which call reasons require the most personnel time, and how has this changed from 2018 to 2022?\n5. Which call actions are associated with the most time-consuming call reasons, and how has this changed?\n6. Are there differences in call volume, reasons, actions, and themes made directly to the local PD and to Shelburne Dispatch?\n7. How often does the LPD refer calls to third parties?\n:::\n\n\n\n## Results: Analysis and Visualization\n\nWhat types of calls are increasing?\nWhat is the change in personnel time needed per call and per type of call?\nWhat days and times of day do we see the most calls or the most change in calls?\nWhy do we need another officer when the populations and number of properties in the two towns have not grown substantially?\n\n### Total hours working on calls\n\nThree key metrics are the number of calls (call volume), average hours worked, and total hours worked. The first question for a municipal department is about what impacts the budget. The change in total hours worked over time shows the big picture:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# initialize df\n# group by year\ncrYearDF <- callReasonsDF %>%\n  group_by(year) %>%\n  summarise(\n    totalCalls = sum(totalCalls),\n    totalHours = sum(totalHours)\n  ) \n\n\n# group by town and year\ncrTownYearDF <- callReasonsDF %>%\n  group_by(town, year) %>%\n  summarise(\n    totalCalls = sum(totalCalls),\n    totalHours = sum(totalHours) \n  ) \n\ncrTownYearThemeDF <- callReasonsDF %>%\n  group_by(town, year, call_theme) %>%\n  summarise(\n    totalCalls = sum(totalCalls),\n    totalHours = sum(totalHours)\n  )\n\n###\n### summary and linear model (lm) calculations for presentation\n###\n\n# Calculate growth percentage of hours worked\n\ncrYeargrowthPctChar <- as.character(round((crYearDF[5,3] - crYearDF[1,3]) / crYearDF[1,3] * 100, 1)) # values used inline to communicate growth, hence character conversions\n\ncrYeargrowthPct <- round(\n  (crYearDF[5,3] - crYearDF[1,3]) / crYearDF[1,3] * 100, 1)[[1]]\n\ncrLevgrowthPct <- round(\n  (crTownYearDF[5,4] - crTownYearDF[1,4]) / crTownYearDF[1,4] * 100, 1)[[1]]\n\ncrWengrowthPct <- round(\n  (crTownYearDF[10,4] - crTownYearDF[6,4]) / crTownYearDF[6,4] * 100, 1)[[1]]\n\n# calculate linear model coefficient estimate of x (hour increase by year)\n\ncrYeargrowthLM <- round(lm(totalHours ~ year(year), \n                           data = crYearDF)$coefficients[2], 1)\n\ncrYeargrowthLMChar <- as.character(crYeargrowthLM)\n\ncrLevgrowthLM <- round(lm(totalHours ~ year(year), \n                          data = filter(crTownYearDF, \n                                        town == \"Leverett\")\n                          )$coefficients[2], 1)\n\ncrWengrowthLM <- round(lm(totalHours ~ year(year), \n                          data = filter(crTownYearDF, \n                                        town == \"Wendell\")\n                          )$coefficients[2], 1)\n\n# calculate weekly hour increase per lm\n\ncrYeargrowthLMweekChar <- as.character(round(crYeargrowthLM / 52, 1))\n\ncrYeargrowthLMweek <- round(crYeargrowthLM / 52, 1)\n\ncrLevgrowthLMweek <- round(crLevgrowthLM / 52, 1)\n\ncrWengrowthLMweek <- round(crWengrowthLM / 52, 1)\n\n# assumed standard 40-hour work week\n\nassumedFTE <- 40\n\n# calculate hour increase per lm in terms of weekly FTE\n\ncrYeargrowthFTE <- round(crYeargrowthLM / 52 / assumedFTE, 2)\n\ncrYeargrowthFTEChar <- as.character(round(crYeargrowthLM / 52 / assumedFTE, 2))\n\ncrLevgrowthFTE <- round(crLevgrowthLM / 52 / assumedFTE, 2)\n\ncrWengrowthFTE <- round(crWengrowthLM / 52 / assumedFTE, 2)\n\n###\n### end of summary and lm calculations \n###\n### now assign to df for presentation:\n\ncrtyGrowthDF <- tribble(\n  ~town, ~yr_pct_growth,  ~yr_hr_growth, ~wk_hr_growth, ~fte_growth,\n  \"Leverett\", crLevgrowthPct, crLevgrowthLM, crLevgrowthLMweek, crLevgrowthFTE,\n  \"Wendell\", crWengrowthPct, crWengrowthLM, crWengrowthLMweek, crWengrowthFTE,\n  \"Both Towns\", crYeargrowthPct, crYeargrowthLM, crYeargrowthLMweek, crYeargrowthFTE\n)\n\n### first plot shows the big picture: change in total hours\n\ncrYearDF %>%\n  ggplot(aes(x = year, y = totalHours)) + \n  geom_area(alpha = 0.5) +\n  labs(title = \"Total hours: Police officers working on calls\",\n       y = \"Hours\") +\n  geom_smooth(method = lm,\n              se = FALSE, \n              linewidth = 1.5,\n              color = \"orangered\") + \n  scale_fill_viridis(discrete = T, option = \"cividis\") +\n  theme_ipsum() +\n  theme(axis.text.x = element_text(angle = 90))\n```\n\n::: {.cell-output-display}\n![](TimShores_FinalProject_working_files/figure-html/chunkTotalHours-1.png){width=960}\n:::\n:::\n\n\nThe big picture shows **81.9% growth** in total hours worked by police officers in the two towns together **from 2018 to 2022**. \n\nAnother way to express this is with a linear model, the **<span style=\"color:orangered;\">orange trend line</span>**: we've seen the two towns add **87.6 hours** of policing every year. This could be useful for the town's personnel planning. Assuming a **40-hour full-time equivalence (FTE)** and an increase of 87.6 hours per year (or **1.7 hours per week**), Leverett and Wendell police call hours grow by **0.04 FTE each year**.\n\nThis answers the first question: \n\n::: {.callout-warning icon=false}\n\n## Specific question for analysis\n\n1. Has the time spent doing police work grown over time?\n\n:::\n\n::: {.callout-tip icon=false}\n\n## An answer!\n\nYes, Leverett and Wendell added 87.6 hours of policing, or 0.04 FTE, every year from 2018 to 2022\n\n:::\n\nNote that 2,080 hours is a year's worth of FTE, and the call data show that the total hours spent policing in both towns is less than 1 FTE. The call hour workload isn't the only factor in public safety personnel management. There is also the need for sufficient coverage so officers are available to respond to calls when they come in. There is also the self-determination of the community: the people who live in a town contribute by right to decisions about public safety. Although these are both necessary elements of a full understanding of policing and public safety, they're beyond the scope of this analysis.\n\n\n### Comparing towns\n\nWhat else could we learn from this data set about what drives this growth in policing?\n\nA simple next step is to compare the towns. Faceting the 3 key metrics by town lets us compare the change in calls and hours worked over the 5-year period:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n  # total call volume by town\ng1 <- crTownYearDF %>%\nggplot(aes(x = year, y = totalCalls, fill = town)) + \n  geom_area(alpha = 0.5, color = \"white\") +\n  labs(title = \"Total call volume by town\",\n       y = \"Calls\") +\n  geom_smooth(method = lm,\n              se = FALSE, \n              linewidth = 1.5,\n              color = \"orangered\") +\n  scale_fill_viridis(discrete = T, option = \"cividis\") +\n  theme_ipsum() +\n  theme(axis.text.x = element_text(angle = 90)) +\n  facet_wrap(vars(town))\n\n  # total hours by town\ng2 <- crTownYearDF %>%\nggplot(aes(x = year, y = totalHours, fill = town)) + \n  geom_area(alpha = 0.5, color = \"white\") +\n  labs(title = \"Total hours by town\",\n       y = \"Hours\") +\n  geom_smooth(method = lm,\n              se = FALSE, \n              linewidth = 1.5,\n              color = \"orangered\") +\n  scale_fill_viridis(discrete = T, option = \"cividis\") +\n  theme_ipsum() +\n  theme(axis.text.x = element_text(angle = 90)) +\n  facet_wrap(vars(town))\n\ngrid.arrange(g1, g2, nrow = 2)\n```\n\n::: {.cell-output-display}\n![](TimShores_FinalProject_working_files/figure-html/chunkByTown-1.png){width=960}\n:::\n:::\n\n\nMost calls come from Leverett and the LPD works most hours in response to Leverett calls. Trends are increasing on all 4 plots, slightly more so in Wendell.\n\nUsing the same analysis that I applied to total hours, this table summarizes rates of change that correspond to the **<span style=\"color:orangered;\">orange trend line</span>** in these plots: \n\n#### Growth trends: Total hours by town\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncrtyGrowthDF\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"town\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"yr_pct_growth\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"yr_hr_growth\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"wk_hr_growth\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"fte_growth\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"Leverett\",\"2\":\"84.3\",\"3\":\"37.9\",\"4\":\"0.7\",\"5\":\"0.02\"},{\"1\":\"Wendell\",\"2\":\"74.3\",\"3\":\"49.7\",\"4\":\"1.0\",\"5\":\"0.02\"},{\"1\":\"Both Towns\",\"2\":\"81.9\",\"3\":\"87.6\",\"4\":\"1.7\",\"5\":\"0.04\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\nThis reveals that Wendell, despite their low proportion of calls and hours, has driven most growth in calls compared with Leverett. \n\nIt's more accurate and fair to say that missing data from Wendell has driven the appearance of call growth in the data. As described earlier, I learned from my discussion with LPD Chief Minckler that Wendell's former police chief didn't log calls consistently. Improved data input by LPD officers has created a more accurate record of policing in Wendell. It's possible to use this data set to estimate Wendell's past police call data, but that's beyond the scope of this analysis.\n\n::: {.callout-warning icon=false}\n\n## Specific questions for analysis\n\n2. Leverett and Wendell began a regionalization agreement in 2020. How has that impacted the data of time spent on calls?\n\n:::\n\n::: {.callout-tip icon=false}\n\n## An answer!\n\nBy taking responsibility for policing in Wendell, LPD officers have improved call data about Wendell policing, bringing it up to LPD quality. When summarizing data inclusively before and after regionalization, Wendell shows **74.3% annual growth** in hours on calls -- or what appears to be **1 additional hour** of police work every week. \n\nAnecdotally, I learned from LPD Chief Minckler that the previous Wendell police chief did not log all calls. With Leverett trends flat, this is likely enough to explain Wendell's high rate. Two to three years from now, LPD will have enough data to make a more confident assessment of Wendell's policing needs.\n\n:::\n\n### Comparing call reasons\n\nWith 122 factor levels, the plot of total hours by call reason is a blur and the legend would take up the whole page.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncrYearReason <- callReasonsDF %>%\n  group_by(year, call_reason) %>%\n  summarize(\n    totalCalls = sum(totalCalls),\n    totalHours = sum(totalHours)\n  )\n\ncrYearReason %>%\n  ggplot(aes(x = year, y = totalHours, fill = call_reason)) +\n    geom_area(alpha = 0.5, show.legend = FALSE, color = \"lavenderblush\") +\n    labs(title = \"Total hours by call reason\",\n         y = \"Hours\") +\n    scale_fill_viridis(discrete = T, option = \"cividis\") +\n    theme_ipsum() +\n    theme(axis.text.x = element_text(angle = 90))\n```\n\n::: {.cell-output-display}\n![](TimShores_FinalProject_working_files/figure-html/chunkByReason1-1.png){width=960}\n:::\n:::\n\n\nGrouping by `call_reason` and summing total hours allows me to learn which types of calls have required the most time. This lollipop plot shows the top 30 call reasons in terms of hours worked in both towns over the 5-year period: \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# this gets factors of top call reasons by hours worked\ntopfactors <- callReasonsDF %>%\n  group_by(call_reason) %>%\n    summarise(\n    totalHours = sum(totalHours)\n  )\n\n  # first we want the top reasons with the most total call hours\ntopfactors <- topfactors %>%\n  arrange(desc(totalHours)) %>%\n  head(n = 30) %>%\n  droplevels.data.frame() # discard the empty factor levels\n\n# will use this to get proportion of each call reason factor\n\ngrandTotalHours = sum(callReasonsDF$totalHours)\n\n# this uses topfactors to target factors for removal\n\ncallReasonsDF %>%\n  group_by(call_reason) %>%\n    summarize(\n    totalHours = sum(totalHours),\n    percentOfAllHours = round(totalHours / grandTotalHours * 100, 1)\n  ) %>%\n  filter(call_reason %in% c(levels(topfactors[[1]]))) %>%\n  droplevels.data.frame() %>% \n  mutate(call_reason = fct_reorder(call_reason, totalHours)) %>% \n  ggplot(aes(x = totalHours, y = call_reason)) +\n  geom_bar(stat = \"identity\", fill = \"dodgerblue4\", alpha = .6, width = 0.3) +  \n  geom_point(size = 4, color = \"orangered\") + \n  geom_text(aes(label = paste0(percentOfAllHours, \"%\"), hjust = -0.5)) +\n  scale_x_continuous(\n    limits = c(0,1500),\n    breaks = seq(0, 1500, 250),\n    minor_breaks = seq(0, 1500, 50),\n    position = \"top\"\n  ) +\n  labs(title = \"Top level-of-effort call reasons\",\n        subtitle = \"Top 30 call reasons 2018-2022 (Total work in number of hours worked and percent of all hours)\",\n        x = \"Hours\",\n        y = \"Reasons\") +\n  #scale_fill_viridis(discrete = T, option = \"cividis\") +\n  theme_ipsum() \n```\n\n::: {.cell-output-display}\n![](TimShores_FinalProject_working_files/figure-html/chunkByReason2-1.png){width=960}\n:::\n\n```{.r .cell-code}\n### HERE\n###\n###\n\n # set a quantile boundary to variable so I can use it in a plot label\n# quantileBoundary = 0.5\n  # we only want reasons with the most total call hours\n# top9factors <- topfactors %>%\n#   arrange(desc(totalHours)) %>%\n#   head(n = 9)\n#   #subset(totalHours > quantile(topfactors$totalHours, quantileBoundary)) %>% \n#   droplevels.data.frame() # discard the empty factor levels\n\n\n  # next we only want top 9 reasons with the most total call hours\ntopfactors <- topfactors %>%\n  arrange(desc(totalHours)) %>%\n  head(n = 9) %>%\n  droplevels.data.frame() # discard the empty factor levels\n\n# this uses topfactors to target factors for removal\n\ncallReasonsDF %>%\n  group_by(call_reason, year) %>%\n    summarize(\n    totalHours = sum(totalHours)\n  ) %>%\n  filter(call_reason %in% c(levels(topfactors[[1]]))) %>%\n  droplevels.data.frame() %>% \n  mutate(call_reason = fct_reorder(call_reason, totalHours)) %>% # this isn't working\n  ggplot(aes(x = year, \n             y = totalHours, \n             fill = call_reason)) +\n  geom_area(alpha = 0.5, color = \"lavenderblush\") +\n  geom_smooth(method = lm,\n              se = FALSE, \n              linewidth = .8,\n              color = \"orangered\",\n              show.legend = FALSE) + \n  theme(axis.text.x = element_text(angle = 90)) +\n  labs(title = \"Top level-of-effort call reasons\",\n       subtitle = \"Leaderboard: 9 call reasons with the most total hours\",\n       y = \"Hours\") +\n  scale_fill_viridis(discrete = T, option = \"cividis\") +\n  theme_ipsum() +\n  theme(axis.text.x = element_text(angle = 90)) +\n  facet_wrap(~call_reason) +\n  theme(strip.text.x = \n          element_text(size = 9, color = \"gray40\", face = \"bold\"))\n```\n\n::: {.cell-output-display}\n![](TimShores_FinalProject_working_files/figure-html/chunkByReason2-2.png){width=960}\n:::\n:::\n\n\nCool story bro\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# a boxplot that doesn't serve a clear purpose yet\ncallReasonsDF %>%\n  ggplot(aes(town, totalHours)) +\n  geom_boxplot() +\n  scale_fill_viridis(discrete = T, option = \"cividis\") +\n  theme_ipsum() +\n  theme(axis.text.x = element_text(angle = 90)) +\n  scale_y_continuous(limits = quantile(callReasonsDF$totalHours, c(0.05, 0.95)))\n```\n\n::: {.cell-output-display}\n![](TimShores_FinalProject_working_files/figure-html/chunkByReason3-1.png){width=960}\n:::\n\n```{.r .cell-code}\n# a pie chart I will probably remove\n\ncallReasonsDF %>% \n    group_by(call_reason) %>%\n    summarize(\n    totalHours = sum(totalHours)\n  ) %>%\n  mutate(call_reason = fct_reorder(call_reason, totalHours)) %>%\n  ggplot(aes(x = \"\", y = totalHours, fill = call_reason)) +\n  geom_bar(stat = \"identity\", width = 1, color = \"lavenderblush\", show.legend = FALSE) +\n  coord_polar(\"y\", start = 0) +\n  #geom_text(aes(y = ypos, label = group), color = \"white\", size=6) +\n  scale_fill_viridis(discrete = T, option = \"cividis\") +\n  theme_ipsum()\n```\n\n::: {.cell-output-display}\n![](TimShores_FinalProject_working_files/figure-html/chunkByReason3-2.png){width=960}\n:::\n\n```{.r .cell-code}\n# this shows relationship between reason and theme\ncallReasonsDF  %>%\n  group_by(call_reason, call_theme, town) %>%\n    summarise(\n    totalHours = sum(totalHours)\n  ) %>%\n  arrange(desc(totalHours)) %>%\n  head(20) %>%\n  ggplot(aes(x = call_theme, y = totalHours, fill = call_reason)) +\n  theme(axis.text.x = element_text(angle = 90)) +\n  geom_bar(stat = \"identity\") +  \n  labs(title = \"Top 20 call reasons by total hours\",\n       subtitle = \"Both towns and all years (2018 to 2022)\",\n       y = \"Hours\") +\n  scale_fill_viridis(discrete = T, option = \"cividis\") +\n  theme_ipsum() +\n  theme(axis.text.x = element_text(angle = 90)) +\n  facet_wrap(vars(town))\n```\n\n::: {.cell-output-display}\n![](TimShores_FinalProject_working_files/figure-html/chunkByReason3-3.png){width=960}\n:::\n\n```{.r .cell-code}\n# group by year and theme\ncrThemeYear <- callReasonsDF %>%\n  group_by(call_theme, year) %>%\n    summarise(\n      totalCalls = sum(totalCalls),\n      totalHours = sum(totalHours) \n  ) \n\ncrThemeYear %>%\n  ggplot(aes(x = year, y = totalHours, fill = call_theme)) + \n    geom_area(alpha = 0.5, show.legend = TRUE, color = \"lavenderblush\") +\n    labs(title = \"Total hours by call theme\",\n         y = \"Hours\") +\n    scale_fill_viridis(discrete = T, option = \"cividis\") +\n    theme_ipsum() +\n    theme(axis.text.x = element_text(angle = 90))\n```\n\n::: {.cell-output-display}\n![](TimShores_FinalProject_working_files/figure-html/chunkByReason3-4.png){width=960}\n:::\n:::\n\n\n\n\n\n\n::: {.callout-warning icon=false}\n\n## Specific questions for analysis\n\n3. What call reasons have grown over time?\n4. Which call reasons require the most personnel time, and how has this changed from 2018 to 2022?\n\n:::\n\n::: {.callout-tip icon=false}\n\n## An answer!\n\n:::\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# order themes by totalCalls  \ncrTownYearThemeDF %>% \n  mutate(call_theme = fct_reorder(call_theme, totalCalls, .fun = 'sum')) %>%\n  ggplot(aes(x = year, y = totalCalls, fill = call_theme)) +\n  geom_area(alpha = 0.5, color = \"white\") +\n  labs(title = \"Total police call volume by call theme\", \n       y = \"Calls\") + \n  scale_fill_viridis(discrete = T, option = \"cividis\") +\n  theme_ipsum() +\n  theme(axis.text.x = element_text(angle = 90))\n```\n\n::: {.cell-output-display}\n![](TimShores_FinalProject_working_files/figure-html/chunkByThemeMAYBE-1.png){width=960}\n:::\n\n```{.r .cell-code}\ncrTownYearThemeDF %>% \n  slice_max(order_by = totalCalls, n = 5) %>%\n  mutate(call_theme = fct_reorder(call_theme, totalCalls, .fun = 'sum')) %>%\n  ggplot(aes(x = year, y = totalCalls, fill = call_theme)) +\n  geom_area() +\n  labs(title = \"Call volume, zoom in on top 5 call themes\", \n       y = \"Calls\") +\n  scale_fill_viridis(discrete = T, option = \"cividis\") +\n  theme_ipsum() +\n  theme(axis.text.x = element_text(angle = 90))\n```\n\n::: {.cell-output-display}\n![](TimShores_FinalProject_working_files/figure-html/chunkByThemeMAYBE-2.png){width=960}\n:::\n\n```{.r .cell-code}\ncrTownYearThemeDF %>% \n  slice_min(order_by = totalCalls, n = 5) %>%\n  mutate(call_theme = fct_reorder(call_theme, totalCalls, .fun = 'sum')) %>%    \n  ggplot(aes(x = year, y = totalCalls, fill = call_theme)) +\n  geom_area() +\n  labs(title = \"Call volume, zoom in on bottom 5 call themes\", \n       subtitle = \"Y-axis at 1/10 scale of top 5 call themes\",\n       y = \"Calls\") +\n  ylim(0, 400) + \n  scale_fill_viridis(discrete = T, option = \"cividis\") +\n  theme_ipsum() +\n  theme(axis.text.x = element_text(angle = 90))\n```\n\n::: {.cell-output-display}\n![](TimShores_FinalProject_working_files/figure-html/chunkByThemeMAYBE-3.png){width=960}\n:::\n:::\n\n\n# Officer hours on calls \n\n\n::: {.cell}\n\n```{.r .cell-code}\n  # totalHours over time by themes, facets\ncrTownYearThemeDF %>% \n  ggplot(aes(x = year, y = totalHours, fill = call_theme)) +\n  geom_area() +\n  theme(axis.text.x = element_text(angle = 90)) +\n  labs(title = \"Total hours\", \n       y = \"Hours\") + \n  scale_fill_viridis(discrete = T, option = \"cividis\") +\n  theme_ipsum() +\n  theme(axis.text.x = element_text(angle = 90)) +\n  facet_wrap(~call_theme, nrow = 2)\n```\n\n::: {.cell-output-display}\n![](TimShores_FinalProject_working_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n\n```{.r .cell-code}\n  # totalHours by top 6 themes\ncrTownYearThemeDF %>% \n  slice_max(order_by = totalHours, n = 6) %>%\n  mutate(call_theme = fct_reorder(call_theme, totalHours, .fun = 'sum')) %>%\n  ggplot(aes(x = year, y = totalHours, fill = call_theme)) +\n  geom_area() +\n  labs(title = \"Total hours: Zoom in on top 6 call themes\", \n       y = \"Hours\") +\n  scale_fill_viridis(discrete = T, option = \"cividis\") +\n  theme_ipsum() +\n  theme(axis.text.x = element_text(angle = 90))\n```\n\n::: {.cell-output-display}\n![](TimShores_FinalProject_working_files/figure-html/unnamed-chunk-6-2.png){width=672}\n:::\n:::\n\n\n\nVisualization will include: \n\n- The change in average and total time on call response over the years, between the two towns. \n- Call reasons by volume and time over the years, between the two towns. \n- Call actions by call reason volume and time over the years, between the two towns.\n- Call volume and time over the years, between the two towns, grouped by public safety themes.\n\n\n\n\n(STORY) Any additional analysis details, and perhaps a backreference to your analysis plan from section 5. (not needed if section 6 is collapsed with sections 2-4)\n(CODE-Optional) Statistical Analyses: see Role of Statistics\n(CODE) Visualization\nYou should organize your graphs and pictures by a small set of topics/questions\nThere is no strict requirement on the number of graphs/figures you should make. However, we expect you to present sufficient graphs that are necessary to answer the question.\n(STORY) Interpret your analyses and visualization results for the reader\nWhat information do the analysis results or graphs tell you?\nYou should describe the information of graphs comprehensively and detailed enough for readers to picture or envision the graphs in their brains.\n\nhttps://dacss.github.io/601_Fall_2022_final_posts/posts/final_project_Guanhua_Tan.html#painting-a-global-map\n\n### Conclusion and Discussion\n(STORY) Conclusion and Discussion \nA brief summary of your work and your findings. What is (are) the answer(s) to your question?\n(optional) Discuss the limitation of your analyses and visualization; and what further analyses or visualizations you would conduct in the future\n\n\n### Bibliography\nHint: at minimum, you should cite the source of the dataset and R as a programming language.\n\t- Any citation style is appropriate since students come from diverse academic backgrounds. Please use whichever style is appropriate for your work.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n######### sanity tests\n######### make more pipelines\n######### make a function for ggplots?\n\n### rubrick items\n# 1 \n# Communication suitable for an expert and general audience\n# 2\n# Data cleaning and recoding choices and justification\n# 3\n# Data driven story-telling (using data to answer questions)\n# 4\n# Effective and efficient coding\n```\n:::\n",
    "supporting": [
      "TimShores_FinalProject_working_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}