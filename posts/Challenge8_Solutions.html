<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Meredith Rolfe &amp; Sean Conway">
<meta name="dcterms.date" content="2023-04-26">

<title>Challenge 8 Solutions</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../images/DACSS_Round_Network.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<link href="../site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="../site_libs/pagedtable-1.1/js/pagedtable.js"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
<meta name="twitter:title" content="Challenge 8 Solutions">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="https://dacss.github.io/601_Spring_2023/posts/solution_images/dod_marital.png">
<meta name="twitter:creator" content="@UMassDACSS">
<meta name="twitter:site" content="@UMassDACSS">
<meta name="twitter:image-height" content="702">
<meta name="twitter:image-width" content="1390">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../images/UMass White Wordmark Horiz.png" alt="" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/DACSS" rel="" target="">
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html" rel="" target="">
 <span class="menu-text">Contributors</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://umass.edu/sbs/dacss" rel="" target="">
 <span class="menu-text">DACSS</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/DACSS" rel="" target=""><i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Challenge 8 Solutions</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
  <div class="quarto-categories">
    <div class="quarto-category">challenge_8</div>
    <div class="quarto-category">activeduty</div>
    <div class="quarto-category">snl</div>
    <div class="quarto-category">faostat</div>
    <div class="quarto-category">solution</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Meredith Rolfe &amp; Sean Conway </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">April 26, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in library(here): there is no package called 'here'</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">echo =</span> <span class="cn">TRUE</span>, <span class="at">warning=</span><span class="cn">FALSE</span>,</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">message=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="challenge-overview" class="level2">
<h2 class="anchored" data-anchor-id="challenge-overview">Challenge Overview</h2>
<ol type="1">
<li>read in multiple data sets, and describe the data set using both words and any supporting information (e.g., tables, etc)</li>
<li>tidy data (as needed, including sanity checks)</li>
<li>mutate variables as needed (including sanity checks)</li>
<li>join two or more data sets and analyze some aspect of the joined data</li>
</ol>
<p>(be sure to only include the category tags for the data you use!)</p>
</section>
<section id="read-in-data" class="level2">
<h2 class="anchored" data-anchor-id="read-in-data">Read in data</h2>
<p>Read in one (or more) of the following datasets, using the correct R package and command.</p>
<ul>
<li>military marriages ⭐⭐</li>
<li>faostat ⭐⭐⭐⭐⭐</li>
<li>snl ⭐⭐⭐⭐</li>
</ul>
<p>:::{.panel-tabset}</p>
</section>
<section id="military-marriages" class="level2">
<h2 class="anchored" data-anchor-id="military-marriages">Military Marriages</h2>
<p>The excel workbook “ActiveDuty_MaritalStatus.xls” contains tabulations of total number of active duty military members classified by marital and family status, for each of the branches of military as well as the military overall. The sheet is a typical government table, so lets figure out what information is actually available! After that, we will clean a single sheet from the workbook, and use that effort to create a generic function that can be used to iterate through all sheets in the workbook to read them and then join them together into a single dataset.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Find Information available</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Read in single sheet</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">Create data reading function</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" role="tab" aria-controls="tabset-1-4" aria-selected="false">Purrr to join</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>Lets first look at an example sheet from the workbook.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="solution_images/dod_marital.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Total DOD Active Duty Marital Sheet</figcaption>
</figure>
</div>
<p>We can see a few things from this example sheet. First, we will need to skip 8 or 9 rows - the data first appears in row 10. Second, the tabular cells represent count <em>values</em> that capture the number of employees falling into subcategories created by 6 distinct grouping values: 1) Pay Grade Type: Enlisted/Officer/Warrant Officer 2) Pay Grade Level: 1-10 (fewer for non-Enlisted) 3) Marital status: Married/Single 4) Parent: Kids/noKids (Single only) 5) Spouse affiliation: Civilian/Military (Married only) 6) Gender: Male/Female</p>
<p>Our goal is to recover cases that have these 6 (or really 5, if we collapse parent and spouse variables as we don’t have complete information) grouping variables to identify the <em>case</em> and the single value (count of active duty employees who fall into each of the resulting subcategories.)</p>
<p>Looking back at the original excel sheet, we can see that we will need to not just skip the top rows, we will also need to delete several columns, and also rename variables in order to make it easy to separate out the three pieces of information contained in the column names. First, I create a vector with column names (to make it easier to reuse later when I pivot to tidy data) then I read in the data and inspect it to see if the columns worked as intended.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>marital_cols <span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"d"</span>, <span class="st">"payGrade_payLevel"</span>,</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>            <span class="st">"single_nokids_male"</span>, <span class="st">"single_nokids_female"</span>, <span class="st">"d"</span>,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">"single_kids_male"</span>, <span class="st">"single_kids_female"</span>, <span class="st">"d"</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">"married_military_male"</span>, <span class="st">"married_military_female"</span>, <span class="st">"d"</span>,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">"married_civilian_male"</span>, <span class="st">"married_civilian_female"</span>, <span class="st">"d"</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rep</span>(<span class="st">"d"</span>, <span class="dv">3</span>))</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">"posts"</span>,<span class="st">"_data"</span>,<span class="st">"ActiveDuty_MaritalStatus.xls"</span>), </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">skip=</span><span class="dv">8</span>,</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">col_names =</span> marital_cols)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in here("posts", "_data", "ActiveDuty_MaritalStatus.xls"): could not find function "here"</code></pre>
</div>
</div>
<p>I can see that the variable names worked well, so this time I will read in the data and omit the original header row, and also filter out the various “TOTAL” rows that we don’t need to keep.</p>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>military<span class="ot">&lt;-</span><span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">"posts"</span>,<span class="st">"_data"</span>,<span class="st">"ActiveDuty_MaritalStatus.xls"</span>), </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">skip=</span><span class="dv">9</span>,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">col_names =</span> marital_cols</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>           )<span class="sc">%&gt;%</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span><span class="fu">starts_with</span>(<span class="st">"d"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(payGrade_payLevel, <span class="st">"TOTAL"</span>, <span class="at">negate=</span><span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in here("posts", "_data", "ActiveDuty_MaritalStatus.xls"): could not find function "here"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>military</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'military' not found</code></pre>
</div>
</div>
<p>It looks like this worked well! Now we just need to pivot_longer with 3 columns, then separate out the information in the <code>payGrade_payLevel</code> variable and do a quick mutate to make paygrade easier to remember.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>military_long <span class="ot">&lt;-</span>military <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">"Marital"</span>, <span class="st">"Other"</span>, <span class="st">"Gender"</span>),</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">"_"</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"count"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(payGrade_payLevel, </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"payGrade"</span>, <span class="st">"payLevel"</span>),</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">sep=</span><span class="st">"-"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">payGrade =</span> <span class="fu">case_when</span>(</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    payGrade <span class="sc">==</span> <span class="st">"E"</span> <span class="sc">~</span> <span class="st">"Enlisted"</span>,</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    payGrade <span class="sc">==</span> <span class="st">"O"</span> <span class="sc">~</span> <span class="st">"Officer"</span>,</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    payGrade <span class="sc">==</span> <span class="st">"W"</span> <span class="sc">~</span> <span class="st">"Warrant Officer"</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'military' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>military_long</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'military_long' not found</code></pre>
</div>
</div>
<p>This all looks like it works well. So now we will go on to creating a function with the steps, then applying it to multiple sheets.</p>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<p>We will call our new function <code>read_military</code>, and we will basically use the exact same commands as above. The big difference is that we will have a placeholder name (or argument) for the data sheet that will be passed to the new function.</p>
<p>Another difference is that when using <code>read_excel()</code> on a workbook with multiple sheets, we need to specify the sheetname of the sheet we wish to read in (we can also specify the sheet name). I then include the <code>mutate()</code> command to create a new column called <code>branch</code>, which comes from our sheet name.</p>
<p>Everything else will be pretty identical to reading a single sheet - <code>select(!starts_with("d"))</code> removes all columns that start with <code>"d"</code>. We also filter out the word “Total” from <code>payGrade_payLevel</code>. <code>pivot_longer()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>read_military<span class="ot">&lt;-</span><span class="cf">function</span>(sheet_name){</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">"posts"</span>,<span class="st">"_data"</span>,<span class="st">"ActiveDuty_MaritalStatus.xls"</span>), </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">sheet =</span> sheet_name,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">skip=</span><span class="dv">9</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">col_names =</span> marital_cols</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>             )<span class="sc">%&gt;%</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">"branch"</span><span class="ot">=</span>sheet_name) <span class="sc">%&gt;%</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span><span class="fu">starts_with</span>(<span class="st">"d"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(payGrade_payLevel, <span class="st">"TOTAL"</span>, <span class="at">negate=</span><span class="cn">TRUE</span>))<span class="sc">%&gt;%</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">contains</span>(<span class="fu">c</span>(<span class="st">"male"</span>, <span class="st">"female"</span>)),</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">"Marital"</span>, <span class="st">"Other"</span>, <span class="st">"Gender"</span>),</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">"_"</span>,</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"count"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(payGrade_payLevel, </span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"payGrade"</span>, <span class="st">"payLevel"</span>),</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">sep=</span><span class="st">"-"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">payGrade =</span> <span class="fu">case_when</span>(</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    payGrade <span class="sc">==</span> <span class="st">"E"</span> <span class="sc">~</span> <span class="st">"Enlisted"</span>,</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    payGrade <span class="sc">==</span> <span class="st">"O"</span> <span class="sc">~</span> <span class="st">"Officer"</span>,</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    payGrade <span class="sc">==</span> <span class="st">"W"</span> <span class="sc">~</span> <span class="st">"Warrant Officer"</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-4-tab">
<p>We now have a function that is customized to read in the mmilitary active duty marital status sheets. We just need to use <code>purrr</code> - a package that is part of tidyverse but which may need to be installed and loaded on its own - to iterate through the list of sheets in the workbook.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>military_sheets<span class="ot">&lt;-</span><span class="fu">excel_sheets</span>(<span class="fu">here</span>(<span class="st">"posts"</span>,<span class="st">"_data"</span>,<span class="st">"ActiveDuty_MaritalStatus.xls"</span>) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in here("posts", "_data", "ActiveDuty_MaritalStatus.xls"): could not find function "here"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>military_sheets</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'military_sheets' not found</code></pre>
</div>
</div>
<p>Now we have a list of sheet names to map with the function. Typically, a purrr::map function creates a list of data frames with each element in the original vector fed to the function as a single list element, as depicted below.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<div>
<p><img src="Challenge8_Solutions_files/figure-html/mermaid-figure-1.png" style="width:6.78in;height:4.47in"></p>
</div>
<p>Purrring Military Workbook</p>
</div>
</div>
</div>
<p>We are going to use <code>map_dfr()</code> to join the four elements of the list into a single dataframe. <code>map</code> is the generic <code>purrr</code> function, and adding on the <code>dfr</code> means that we want to turn all of the list elements created by <code>map</code> into a single datafame (df) that is joined by rows (r).</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
using <code>map_dfr</code>
</div>
</div>
<div class="callout-body-container callout-body">
<p>There are functions in <code>purrr</code> that automatically convert the list created by map into the dataframe shape that you want, but you need to be careful that the objects being mapped have the correct column names (or rows, if you are using <code>map_dfc()</code> to avoid errors. Plain <code>map</code> is the safe option, but you then have to manually join the data.)</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>military_all <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">excel_sheets</span>(<span class="fu">here</span>(<span class="st">"posts"</span>,<span class="st">"_data"</span>,<span class="st">"ActiveDuty_MaritalStatus.xls"</span>))[<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>],</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  read_military)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in here("posts", "_data", "ActiveDuty_MaritalStatus.xls"): could not find function "here"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>military_all</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'military_all' not found</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="faostat-regions" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="faostat-regions">FAOstat Regions</h2>
<p>The FAOSTAT sheets are excerpts of the <a href="https://www.fao.org/faostat/en/#home">FAOSTAT database</a> provided by the <a href="https://www.fao.org/home/en">Food and Agriculture Association</a>, an agency of the United Nations. There are two approaches we could use to joining these data. In this section, we are going to join livestock estimates from a single file to regional codes for the countries.</p>
<p>The file <em>birds.csv</em> that includes estimates of the stock of five different types of poultry (Chickens, Ducks, Geese and guinea fowls, Turkeys, and Pigeons/Others) in 248 areas for 58 years between 1961-2018. Because we know (from challenge 1) that several of those areas include aggregated data (e.g., ) we are going to remove the aggregations and replace the case level aggregations with the correct grouping variables from the file “FAOSTAT_country_groups.csv”, downloaded from <a href="https://www.fao.org/faostat/en/#definitions">Country Region definitions</a> provided by the FAO. As a reminder, I am going to split the original birds data into country level and aggregated data, and then list the aggregated groups we found in Challenge 1.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>birds_orig<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"posts"</span>,<span class="st">"_data"</span>,<span class="st">"birds.csv"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">contains</span>(<span class="st">"Code"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in here("posts", "_data", "birds.csv"): could not find function "here"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>birds_agg<span class="ot">&lt;-</span>birds_orig<span class="sc">%&gt;%</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Flag<span class="sc">==</span><span class="st">"A"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'birds_orig' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>birds<span class="ot">&lt;-</span>birds_orig<span class="sc">%&gt;%</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Flag<span class="sc">!=</span><span class="st">"A"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'birds_orig' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(birds_agg<span class="sc">$</span>Area)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'birds_agg' not found</code></pre>
</div>
</div>
<p>With the FAO regional information, we can find out which countries are in which regions:</p>
<div class="cell page-columns page-full">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>fao_regions_orig <span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="st">"_data/FAOSTAT_country_groups.csv"</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>fao_regions<span class="ot">&lt;-</span>fao_regions_orig<span class="sc">%&gt;%</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">Country Group</span><span class="st">`</span>, Country)<span class="sc">%&gt;%</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">country_group =</span> <span class="st">`</span><span class="at">Country Group</span><span class="st">`</span>)<span class="sc">%&gt;%</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>fao_regions<span class="sc">%&gt;%</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country_group <span class="sc">==</span> <span class="st">"Polynesia"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display column-page">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["country_group"],"name":[1],"type":["chr"],"align":["left"]},{"label":["Country"],"name":[2],"type":["chr"],"align":["left"]}],"data":[{"1":"Polynesia","2":"American Samoa"},{"1":"Polynesia","2":"Cook Islands"},{"1":"Polynesia","2":"French Polynesia"},{"1":"Polynesia","2":"Niue"},{"1":"Polynesia","2":"Pitcairn"},{"1":"Polynesia","2":"Polynesia, unspecified"},{"1":"Polynesia","2":"Samoa"},{"1":"Polynesia","2":"Tokelau"},{"1":"Polynesia","2":"Tonga"},{"1":"Polynesia","2":"Tuvalu"},{"1":"Polynesia","2":"Wake Island"},{"1":"Polynesia","2":"Wallis and Futuna Islands"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Clearly, some of the groups might overlap. For example, one group is called World and clearly overlaps with all other groups. So, before we join, lets remove the World group and then inspect the country-region pairings to ensure there are no other overlaps.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>temp<span class="ot">&lt;-</span>fao_regions<span class="sc">%&gt;%</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country_group)<span class="sc">%&gt;%</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n=</span><span class="fu">n</span>())<span class="sc">%&gt;%</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n))</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>half <span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">round</span>(<span class="fu">nrow</span>(temp)<span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">list</span>(temp[half,],  </span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>           <span class="fu">matrix</span>(<span class="fu">numeric</span>(), <span class="at">nrow=</span><span class="dv">0</span>, <span class="at">ncol=</span><span class="dv">1</span>),</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>           temp[<span class="sc">-</span>half,]), </span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">caption =</span> <span class="st">"Countries in Country Groups"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(<span class="at">font_size=</span><span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in loadNamespace(x): there is no package called 'kableExtra'</code></pre>
</div>
</div>
<p>Unfortunately, we can see that many regions must overlap - which is super annoying. We need to essentially extract the country-level or regional groupings - of which there seem to be up to 7 or 8 - potentially nested or perhaps not - country grouping categories - to fully disentangle the various aggregations contained in the original data. The demonstration below quickly identifies four major grouping categories to extract and confirms that there are approximately 277 countries (or less) in each grouping category. More detailed work could be used to nest sub-regions within regions (e.g., Eastern Europe would nest within Europe, and so on.)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>fao_regions<span class="sc">%&gt;%</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>())<span class="sc">/</span><span class="dv">277</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["n"],"name":[1],"type":["dbl"],"align":["right"]}],"data":[{"1":"7.01444"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>fao_regions<span class="sc">%&gt;%</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(country_group, <span class="st">"[aA]nnex"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country_group)<span class="sc">%&gt;%</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["country_group"],"name":[1],"type":["chr"],"align":["left"]},{"label":["n"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"Annex I countries","2":"78"},{"1":"Non-Annex I countries","2":"161"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>fao_regions<span class="sc">%&gt;%</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(country_group, <span class="st">"[aA]nnex"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["n"],"name":[1],"type":["int"],"align":["right"]}],"data":[{"1":"239"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>fao_regions<span class="sc">%&gt;%</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(country_group, <span class="st">"[iI]ncome"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country_group)<span class="sc">%&gt;%</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["country_group"],"name":[1],"type":["chr"],"align":["left"]},{"label":["n"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"High-income economies","2":"64"},{"1":"Low Income Food Deficit Countries","2":"55"},{"1":"Low income economies","2":"34"},{"1":"Lower-middle-income economies","2":"46"},{"1":"Upper-middle-income economies","2":"56"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>fao_regions<span class="sc">%&gt;%</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(country_group, <span class="st">"[iI]ncome"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["n"],"name":[1],"type":["int"],"align":["right"]}],"data":[{"1":"255"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>fao_regions<span class="sc">%&gt;%</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(country_group, <span class="st">"[Dd]evelop|OECD"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country_group)<span class="sc">%&gt;%</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["country_group"],"name":[1],"type":["chr"],"align":["left"]},{"label":["n"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"Land Locked Developing Countries","2":"32"},{"1":"Least Developed Countries","2":"51"},{"1":"Net Food Importing Developing Countries","2":"81"},{"1":"OECD","2":"36"},{"1":"Small Island Developing States","2":"58"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>fao_regions<span class="sc">%&gt;%</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(country_group, <span class="st">"[Dd]evelop|OECD"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["n"],"name":[1],"type":["int"],"align":["right"]}],"data":[{"1":"258"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>major_regions<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"Africa"</span>, <span class="st">"Asia"</span>, <span class="st">"Europe"</span>, <span class="st">"Americas"</span>, </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"Oceania"</span>, <span class="st">"Antarctic Region"</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>fao_regions<span class="sc">%&gt;%</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country_group <span class="sc">%in%</span> major_regions)<span class="sc">%&gt;%</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["n"],"name":[1],"type":["int"],"align":["right"]}],"data":[{"1":"277"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>We now use the <code>unite</code> command to create four new categorical variables corresponding to the four country groupings we have identified that contain most or all of the 277 countries included in the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>fao_regions_wide<span class="ot">&lt;-</span>fao_regions<span class="sc">%&gt;%</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country_group<span class="sc">!=</span><span class="st">"World"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from=</span>country_group, <span class="at">values_from =</span> <span class="dv">1</span>)<span class="sc">%&gt;%</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(<span class="st">"gp_annex"</span>, <span class="fu">contains</span>(<span class="st">"Annex"</span>), </span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">sep=</span><span class="st">""</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>, <span class="at">remove=</span><span class="cn">TRUE</span>)<span class="sc">%&gt;%</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(<span class="st">"gp_major_region"</span>, <span class="fu">any_of</span>(major_regions), </span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">sep=</span><span class="st">""</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>, <span class="at">remove=</span><span class="cn">TRUE</span>)<span class="sc">%&gt;%</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(<span class="st">"gp_income"</span>, <span class="fu">contains</span>(<span class="st">"Income"</span>)<span class="sc">|</span><span class="fu">contains</span>(<span class="st">"income"</span>),</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">sep=</span><span class="st">""</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>, <span class="at">remove=</span><span class="cn">TRUE</span>)<span class="sc">%&gt;%</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(<span class="st">"gp_develop"</span>, <span class="fu">contains</span>(<span class="st">"Develop"</span>)<span class="sc">|</span><span class="fu">contains</span>(<span class="st">"OECD"</span>),</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">sep=</span><span class="st">""</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>, <span class="at">remove=</span><span class="cn">TRUE</span>)<span class="sc">%&gt;%</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Country, <span class="fu">starts_with</span>(<span class="st">"gp"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="join-to-livestock-data" class="level3">
<h3 class="anchored" data-anchor-id="join-to-livestock-data">Join to livestock data</h3>
<p>Now that we have countries and four regional breakdown indicators, we can join this data to our original livestock data by countryname. I am going to do a left_join, as each case includes a country, and we want to match countries to join the four regional indicators. Because the <em>Country</em> variable is described as <em>Area</em> in the original birds data, we want to explicitly set the two key fields for the join.</p>
<p>We should end up with the same number of rows in the “birds” data as we started off with. An <code>inner_join</code> would also work in this case, would effectively omit from the left-hand side data any aggregated cases left in by mistake (it would only keep rows where “Area” matched one of the “Country” values.)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(birds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'birds' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>birds <span class="ot">&lt;-</span> <span class="fu">left_join</span>(birds, fao_regions_wide,</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"Area"</span> <span class="ot">=</span> <span class="st">"Country"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'birds' not found</code></pre>
</div>
</div>
<p>Now, you can summarize across countries grouped by income, development status, major region, or Annex/non-Annex.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>eggs_chicken <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">"posts"</span>,<span class="st">"_data"</span>,<span class="st">"FAOSTAT_egg_chicken.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in here("posts", "_data", "FAOSTAT_egg_chicken.csv"): could not find function "here"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>cattle <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">"posts"</span>,<span class="st">"_data"</span>,<span class="st">"FAOSTAT_egg_chicken.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in here("posts", "_data", "FAOSTAT_egg_chicken.csv"): could not find function "here"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">left_join</span>(eggs_chicken, cattle, <span class="at">by=</span><span class="st">"Area"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'eggs_chicken' not found</code></pre>
</div>
</div>
</section>
</section>
<section id="faostat-regions-1" class="level2">
<h2 class="anchored" data-anchor-id="faostat-regions-1">FAOstat: Regions</h2>
<p>The FAOSTAT sheets are excerpts of the <a href="https://www.fao.org/faostat/en/#home">FAOSTAT database</a> provided by the <a href="https://www.fao.org/home/en">Food and Agriculture Association</a>, an agency of the United Nations. There are two approaches we could use to joining these data. In this section, we are going to join livestock estimates from multiple “faostat…” files.</p>
<p>We have already seen that the file <em>birds.csv</em> includes estimates of the stock of five different types of poultry (Chickens, Ducks, Geese and guinea fowls, Turkeys, and Pigeons/Others) in 248 areas for 58 years between 1961-2018. What about the other “FAOSTAT_*” files?</p>
<p>Lets read them into a single list, and see what we find. First, lets write a function to just read in the file and then print out the column names.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
list.files()
</div>
</div>
<div class="callout-body-container callout-body">
<p>There are base R functions that allow you to easily interact with the underlying system, just like you would at the command line or in the terminal. One of my favorites is <code>list.files()</code>, which does exactly what it says on the tin! The pattern matching used in the terminal may vary slightly depending on your operating system.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>read_faostat<span class="ot">&lt;-</span><span class="cf">function</span>(fn){</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  fao<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="fu">str_c</span>(<span class="fu">here</span>(<span class="st">"posts"</span>,<span class="st">"_data"</span>), fn, <span class="at">sep=</span><span class="st">"/"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">contains</span>(<span class="st">"Code"</span>))</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">colnames</span>(fao))</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>fao_files<span class="ot">&lt;-</span><span class="fu">list.files</span>(<span class="at">path=</span><span class="fu">here</span>(<span class="st">"posts"</span>,<span class="st">"_data"</span>), <span class="at">pattern=</span><span class="st">"FAOSTAT*"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in here("posts", "_data"): could not find function "here"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>fao_files[<span class="dv">2</span>]<span class="ot">&lt;-</span><span class="st">"birds.csv"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: object 'fao_files' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(fao_files, read_faostat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'fao_files' not found</code></pre>
</div>
</div>
<p>We can see from this that the column names are identical in the four datasets, which makes them easy to merge. Additionally, we suspect from the <em>birds</em> dataset that the <em>Domain</em> variable will uniquely identify the dataset, lets see if we are correct by modifying our <code>read_faostat</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>read_faostat<span class="ot">&lt;-</span><span class="cf">function</span>(fn){</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  fao<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="fu">str_c</span>(<span class="fu">here</span>(<span class="st">"posts"</span>,<span class="st">"_data"</span>), fn, <span class="at">sep=</span><span class="st">"/"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">contains</span>(<span class="st">"Code"</span>))</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">Domain =</span> <span class="fu">unique</span>(fao<span class="sc">$</span>Domain),</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">Elements =</span> <span class="fu">unique</span>(fao<span class="sc">$</span>Element),</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">Items =</span> <span class="fu">unique</span>(fao<span class="sc">$</span>Item),</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">obs =</span> <span class="fu">nrow</span>(fao)))</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(fao_files, read_faostat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'fao_files' not found</code></pre>
</div>
</div>
<p>What an easy way to learn a lot about the data quickly. Sure enough, we can now merge the data back together and have way too much information in the same R object :-) This time, we will modify the <code>read_faostat</code> function to only read in the data, and then use <code>purrr::map_dfr()</code> to join.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>read_faostat<span class="ot">&lt;-</span><span class="cf">function</span>(fn){</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  fao<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="fu">str_c</span>(<span class="fu">here</span>(<span class="st">"posts"</span>,<span class="st">"_data"</span>), fn, <span class="at">sep=</span><span class="st">"/"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">contains</span>(<span class="st">"Code"</span>))</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(fao)</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>faostat<span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(fao_files, read_faostat)<span class="sc">%&gt;%</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(fao_regions_wide, </span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">by=</span><span class="fu">c</span>(<span class="st">"Area"</span> <span class="ot">=</span> <span class="st">"Country"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'fao_files' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>faostat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'faostat' not found</code></pre>
</div>
</div>
</section>
<section id="snl" class="level2">
<h2 class="anchored" data-anchor-id="snl">SNL</h2>
</section>
<section id="the-data" class="level2">
<h2 class="anchored" data-anchor-id="the-data">The Data</h2>
<p>These data came to my attention courtesy of Jeremy Singer-Vine’s wonderful <a href="data-is-plural.com">Data is Plural</a> newsletter. <a href="https://github.com/hhllcks/snldb">These datasets</a>, archived by Joel Navaroli and scraped by Hendrik Hilleckes and Colin Morris, contain data about the actors, cast, seasons, etc. from every season of Saturday Night Live from its inception through 2020.</p>
<p>We will be working with three data files: <code>actors.csv</code>, <code>casts.csv</code>, and <code>seasons.csv</code>. Before we read in the data, we’ll need to load the <code>dplyr</code>, <code>tidyr</code>, <code>ggplot2</code>, and <code>readr</code> packages.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now let’s read in the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>actors <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"posts"</span>,<span class="st">"_data"</span>,<span class="st">"snl_actors.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in here("posts", "_data", "snl_actors.csv"): could not find function "here"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>casts <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"posts"</span>,<span class="st">"_data"</span>,<span class="st">"snl_casts.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in here("posts", "_data", "snl_casts.csv"): could not find function "here"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>seasons <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"posts"</span>,<span class="st">"_data"</span>,<span class="st">"snl_seasons.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in here("posts", "_data", "snl_seasons.csv"): could not find function "here"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>rmarkdown<span class="sc">::</span><span class="fu">paged_table</span>(actors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'actors' not found</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>rmarkdown<span class="sc">::</span><span class="fu">paged_table</span>(casts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'casts' not found</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>rmarkdown<span class="sc">::</span><span class="fu">paged_table</span>(seasons)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'seasons' not found</code></pre>
</div>
</div>
</section>
<section id="analysis" class="level2">
<h2 class="anchored" data-anchor-id="analysis">Analysis</h2>
<p>We’re going to be focusing on how the gender makeup of the SNL cast has changed over time. There’s a well-known bias in the entertainment industry in favor of male performers, particularly in comedy. We’ll be examining the data to see how/if SNL exhibits such a bias as well as how it has evolved over the years.</p>
<p>The <code>casts</code> dataframe contains data about each cast member from each seasons. However, it does not contain any information about the cast members’ gender, which is stored in the <code>actors</code> dataframe. In turn, the <code>actors</code> dataframe contains no information about the seasons in which the cast members appeared.</p>
<p>We will use <code>left_join()</code> to merge these two data sets, by <code>aid</code> (actor ID). We also use <code>filter()</code> to remove all guest stars and crew members from the <code>actors</code> data frame. Then, we use <code>count()</code> to tally the gender makeup of season.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>casts_gender_count <span class="ot">&lt;-</span> casts  <span class="sc">%&gt;%</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">filter</span>(actors,type<span class="sc">==</span><span class="st">"cast"</span>),</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">by=</span><span class="st">"aid"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sid,gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'casts' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>rmarkdown<span class="sc">::</span><span class="fu">paged_table</span>(casts_gender_count)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'casts_gender_count' not found</code></pre>
</div>
</div>
<p>We now have a nice dataframe containing the counts of each unique gender from each season of Saturday Night Live.</p>
<p>Next, we perform a number of operations on the data. First, we use <code>group_by()</code> and <code>mutate()</code> to compute the proportion of gender per season. Some seasons only have <code>"male"</code> and <code>"female"</code> as the unique genders, while others have <code>"male"</code>, <code>"female"</code>, <code>"other"</code>, and “<code>NA"</code>. We want to include all available levels of <code>gender</code> for each season. To do so, we need to use <code>pivot_wider()</code>, <code>mutate()</code>, and <code>replace_na()</code> to ensure each level of <code>gender</code> is available for each season. We then use <code>pivot_longer()</code> to get the data back in a format that will be useful for visualization.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>casts_prop_all <span class="ot">&lt;-</span> casts_gender_count <span class="sc">%&gt;%</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sid) <span class="sc">%&gt;%</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop=</span>n<span class="sc">/</span><span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>n) <span class="sc">%&gt;%</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> gender,</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> prop) <span class="sc">%&gt;%</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(),<span class="sc">~</span><span class="fu">replace_na</span>(.,<span class="dv">0</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(female,male,<span class="st">`</span><span class="at">NA</span><span class="st">`</span>,unknown),</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"prop"</span>,</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span>  <span class="st">"gender"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'casts_gender_count' not found</code></pre>
</div>
</div>
<section id="visualizing" class="level3">
<h3 class="anchored" data-anchor-id="visualizing">Visualizing</h3>
<p>This first visualization is straightforward. We simply use <code>geom_path()</code> to plot a line of the proportion for each gender for each season of Saturday Night Live.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(casts_prop_all,<span class="fu">aes</span>(sid,prop,<span class="at">col=</span>gender))<span class="sc">+</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'casts_prop_all' not found</code></pre>
</div>
</div>
<p>The plot looks good, but let’s do some more customizing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(casts_prop_all,<span class="fu">aes</span>(sid,prop,<span class="at">col=</span>gender))<span class="sc">+</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>()<span class="sc">+</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name=</span><span class="st">"Gender"</span>)<span class="sc">+</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Season"</span>,</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">"Proportion"</span>,</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">title=</span><span class="st">"Saturday Night Live"</span>,</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle=</span><span class="st">"Gender Makeup by Season"</span>)<span class="sc">+</span></span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust=</span><span class="fl">0.5</span>),</span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle=</span><span class="fu">element_text</span>(<span class="at">hjust=</span><span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'casts_prop_all' not found</code></pre>
</div>
</div>
<p>It looks like over the years, the gender makeup has slowly trended towards equality, but we are far from full equality in SNL.</p>
<p>One more note: the reader may have a hard time contextualizing these data in terms of “Season Number”. It may be more helpful to plot these data in terms of the <strong>YEAR</strong> the season aired. To do that, we need to use <code>left_join()</code> to combine our data with the <code>seasons</code> dataframe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>casts_prop_all <span class="sc">%&gt;%</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(seasons,<span class="at">by=</span><span class="st">"sid"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(year,prop,<span class="at">col=</span>gender))<span class="sc">+</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>()<span class="sc">+</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">1975</span>,<span class="dv">2020</span>),</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">1975</span>,<span class="dv">2020</span>,<span class="dv">5</span>))<span class="sc">+</span></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name=</span><span class="st">"Gender"</span>)<span class="sc">+</span></span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Year"</span>,</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">"Proportion"</span>,</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">title=</span><span class="st">"Saturday Night Live"</span>,</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle=</span><span class="st">"Gender Makeup by Year"</span>)<span class="sc">+</span></span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust=</span><span class="fl">0.5</span>),</span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle=</span><span class="fu">element_text</span>(<span class="at">hjust=</span><span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'casts_prop_all' not found</code></pre>
</div>
</div>
<p>That’s better. This way, the reader can contextualize the data easier.</p>
</section>
</section>
<section id="more-analysisvisualization" class="level2">
<h2 class="anchored" data-anchor-id="more-analysisvisualization">More analysis/visualization</h2>
<p>We might also consider analyzing the male/non-male ratio over the years, to get an idea of the magnitude of gender bias in the way a proportion might not give us. To do so, we use <code>pivot_wider()</code>, <code>mutate()</code>, <code>replace_na()</code>, and <code>left_join()</code> again to get a measure of <span class="math inline">\(\frac{male}{nonmale}\)</span> ratio over the years. We again use <code>geom_path()</code> to plot this ratio over the years. We also use <code>geom_hline()</code> to plot a horizontal line where <span class="math inline">\(\frac{male}{nonmale}\)</span> ratio equals 1.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>casts_gender_count <span class="sc">%&gt;%</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> gender,</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> n) <span class="sc">%&gt;%</span> </span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(<span class="st">`</span><span class="at">NA</span><span class="st">`</span>,unknown,male,female),<span class="sc">~</span><span class="fu">replace_na</span>(.,<span class="dv">0</span>)),</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">male_nonmale_ratio=</span>male<span class="sc">/</span>(female<span class="sc">+</span>unknown<span class="sc">+</span><span class="st">`</span><span class="at">NA</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(seasons,<span class="at">by=</span><span class="st">"sid"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(year,male_nonmale_ratio))<span class="sc">+</span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">col=</span><span class="st">"dodgerblue3"</span>)<span class="sc">+</span></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="dv">1</span>,<span class="at">col=</span><span class="st">"red"</span>,<span class="at">linetype=</span><span class="st">"dashed"</span>)<span class="sc">+</span></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>))<span class="sc">+</span></span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Year"</span>,</span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">"Male/Non-Male Ratio"</span>,</span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">title=</span><span class="st">"Saturday Night Live"</span>,</span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle=</span><span class="st">"Male Bias Over the Years"</span>)<span class="sc">+</span></span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span><span class="fu">element_text</span>(<span class="at">hjust=</span><span class="fl">0.5</span>),</span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle=</span><span class="fu">element_text</span>(<span class="at">hjust=</span><span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'casts_gender_count' not found</code></pre>
</div>
</div>
<p>Again, it looks like there’s been a consistent male bias over the years, which, although trending downward, does not suggest we are at any sort of equality/representation in entertainment.</p>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>We’ve managed to put together a relatively straightforward analysis &amp; visualization of the gender makeup of Saturday Night Live over the years. A more complex analysis might also take into account the number of sketches cast members of each gender performed in over the years.</p>
<p>In addition, there are numerous other demographic variables not currently taking into consideration that might provide a more complete analysis of representation in the entertainment industry.</p>
<p>With that being said, this relatively simple analysis is intended to be pedagogical in nature, as a way to demonstrate further some of the helpful data analysis tools available in <code>dplyr</code>, <code>tidyr</code>, and <code>ggplot2</code>.</p>


<!-- -->

</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Note: A male/non-male ratio of 1 does NOT indicate a lack of gender bias, as the full spectrum of gender is not represented at all in these data. Rather, it indicates a lack of bias in favor of males when compared with the combined sum of all other genders currently available in the data. That is, a value of 1 is not evidence in favor of gender equality in the data.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="DACSS/601_Spring_2023" data-repo-id="R_kgDOI4JcJA" data-category="Announcements" data-category-id="" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb92" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Challenge 8 Solutions"</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Meredith Rolfe &amp; Sean Conway"</span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a><span class="an">desription:</span><span class="co"> "Data wrangling: joining data"</span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "04/26/2023"</span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a><span class="co">    df-print: paged</span></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: false</span></span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: false</span></span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a><span class="co">    code-copy: true</span></span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a><span class="co">    css: styles.css</span></span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a><span class="co">    mermaid-format: png</span></span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span></span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a><span class="co">  - challenge_8</span></span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a><span class="co">  - activeduty</span></span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a><span class="co">  - snl</span></span>
<span id="cb92-19"><a href="#cb92-19" aria-hidden="true" tabindex="-1"></a><span class="co">  - faostat</span></span>
<span id="cb92-20"><a href="#cb92-20" aria-hidden="true" tabindex="-1"></a><span class="co">  - solution</span></span>
<span id="cb92-21"><a href="#cb92-21" aria-hidden="true" tabindex="-1"></a><span class="co">  </span></span>
<span id="cb92-22"><a href="#cb92-22" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb92-23"><a href="#cb92-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-26"><a href="#cb92-26" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-27"><a href="#cb92-27" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: setup</span></span>
<span id="cb92-28"><a href="#cb92-28" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb92-29"><a href="#cb92-29" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb92-30"><a href="#cb92-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-31"><a href="#cb92-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb92-32"><a href="#cb92-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb92-33"><a href="#cb92-33" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb92-34"><a href="#cb92-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-35"><a href="#cb92-35" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">echo =</span> <span class="cn">TRUE</span>, <span class="at">warning=</span><span class="cn">FALSE</span>,</span>
<span id="cb92-36"><a href="#cb92-36" aria-hidden="true" tabindex="-1"></a>                      <span class="at">message=</span><span class="cn">FALSE</span>)</span>
<span id="cb92-37"><a href="#cb92-37" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-38"><a href="#cb92-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-39"><a href="#cb92-39" aria-hidden="true" tabindex="-1"></a><span class="fu">## Challenge Overview</span></span>
<span id="cb92-40"><a href="#cb92-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-41"><a href="#cb92-41" aria-hidden="true" tabindex="-1"></a>1)  read in multiple data sets, and describe the data set using both words and any supporting information (e.g., tables, etc)</span>
<span id="cb92-42"><a href="#cb92-42" aria-hidden="true" tabindex="-1"></a>2)  tidy data (as needed, including sanity checks)</span>
<span id="cb92-43"><a href="#cb92-43" aria-hidden="true" tabindex="-1"></a>3)  mutate variables as needed (including sanity checks)</span>
<span id="cb92-44"><a href="#cb92-44" aria-hidden="true" tabindex="-1"></a>4)  join two or more data sets and analyze some aspect of the joined data</span>
<span id="cb92-45"><a href="#cb92-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-46"><a href="#cb92-46" aria-hidden="true" tabindex="-1"></a>(be sure to only include the category tags for the data you use!)</span>
<span id="cb92-47"><a href="#cb92-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-48"><a href="#cb92-48" aria-hidden="true" tabindex="-1"></a><span class="fu">## Read in data</span></span>
<span id="cb92-49"><a href="#cb92-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-50"><a href="#cb92-50" aria-hidden="true" tabindex="-1"></a>Read in one (or more) of the following datasets, using the correct R package and command.</span>
<span id="cb92-51"><a href="#cb92-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-52"><a href="#cb92-52" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>military marriages ⭐⭐</span>
<span id="cb92-53"><a href="#cb92-53" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>faostat ⭐⭐⭐⭐⭐</span>
<span id="cb92-54"><a href="#cb92-54" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>snl ⭐⭐⭐⭐</span>
<span id="cb92-55"><a href="#cb92-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-56"><a href="#cb92-56" aria-hidden="true" tabindex="-1"></a>:::{.panel-tabset}</span>
<span id="cb92-57"><a href="#cb92-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-58"><a href="#cb92-58" aria-hidden="true" tabindex="-1"></a><span class="fu">## Military Marriages</span></span>
<span id="cb92-59"><a href="#cb92-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-60"><a href="#cb92-60" aria-hidden="true" tabindex="-1"></a>The excel workbook "ActiveDuty_MaritalStatus.xls" contains tabulations of total number of active duty military members classified by marital and family status, for each of the branches of military as well as the military overall. The sheet is a typical government table, so lets figure out what information is actually available! After that, we will clean a single sheet from the workbook, and use that effort to create a generic function that can be used to iterate through all sheets in the workbook to read them and then join them together into a single dataset.</span>
<span id="cb92-61"><a href="#cb92-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-62"><a href="#cb92-62" aria-hidden="true" tabindex="-1"></a>:::{.panel-tabset}</span>
<span id="cb92-63"><a href="#cb92-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-64"><a href="#cb92-64" aria-hidden="true" tabindex="-1"></a><span class="fu">### Find Information available</span></span>
<span id="cb92-65"><a href="#cb92-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-66"><a href="#cb92-66" aria-hidden="true" tabindex="-1"></a>Lets first look at an example sheet from the workbook.</span>
<span id="cb92-67"><a href="#cb92-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-68"><a href="#cb92-68" aria-hidden="true" tabindex="-1"></a><span class="al">![Total DOD Active Duty Marital Sheet](solution_images/dod_marital.png)</span></span>
<span id="cb92-69"><a href="#cb92-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-70"><a href="#cb92-70" aria-hidden="true" tabindex="-1"></a>We can see a few things from this example sheet. First, we will need to skip 8 or 9 rows - the data first appears in row 10. Second, the tabular cells represent count *values* that capture the number of employees falling into subcategories created by 6 distinct grouping values:</span>
<span id="cb92-71"><a href="#cb92-71" aria-hidden="true" tabindex="-1"></a>  1) Pay Grade Type: Enlisted/Officer/Warrant Officer</span>
<span id="cb92-72"><a href="#cb92-72" aria-hidden="true" tabindex="-1"></a>  2) Pay Grade Level: 1-10 (fewer for non-Enlisted)</span>
<span id="cb92-73"><a href="#cb92-73" aria-hidden="true" tabindex="-1"></a>  3) Marital status: Married/Single</span>
<span id="cb92-74"><a href="#cb92-74" aria-hidden="true" tabindex="-1"></a>  4) Parent: Kids/noKids (Single only)</span>
<span id="cb92-75"><a href="#cb92-75" aria-hidden="true" tabindex="-1"></a>  5) Spouse affiliation: Civilian/Military (Married only)</span>
<span id="cb92-76"><a href="#cb92-76" aria-hidden="true" tabindex="-1"></a>  6) Gender: Male/Female</span>
<span id="cb92-77"><a href="#cb92-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-78"><a href="#cb92-78" aria-hidden="true" tabindex="-1"></a>Our goal is to recover cases that have these 6 (or really 5, if we collapse parent and spouse variables as we don't have complete information) grouping variables to identify the *case* and the single value (count of active duty employees who fall into each of the resulting subcategories.)</span>
<span id="cb92-79"><a href="#cb92-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-80"><a href="#cb92-80" aria-hidden="true" tabindex="-1"></a>Looking back at the original excel sheet, we can see that we will need to not just skip the top rows, we will also need to delete several columns, and also rename variables in order to make it easy to separate out the three pieces of information contained in the column names. First, I create a vector with column names (to make it easier to reuse later when I pivot to tidy data) then I read in the data and inspect it to see if the columns worked as intended.</span>
<span id="cb92-81"><a href="#cb92-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-82"><a href="#cb92-82" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE}</span></span>
<span id="cb92-83"><a href="#cb92-83" aria-hidden="true" tabindex="-1"></a>marital_cols <span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"d"</span>, <span class="st">"payGrade_payLevel"</span>,</span>
<span id="cb92-84"><a href="#cb92-84" aria-hidden="true" tabindex="-1"></a>            <span class="st">"single_nokids_male"</span>, <span class="st">"single_nokids_female"</span>, <span class="st">"d"</span>,</span>
<span id="cb92-85"><a href="#cb92-85" aria-hidden="true" tabindex="-1"></a>            <span class="st">"single_kids_male"</span>, <span class="st">"single_kids_female"</span>, <span class="st">"d"</span>,</span>
<span id="cb92-86"><a href="#cb92-86" aria-hidden="true" tabindex="-1"></a>            <span class="st">"married_military_male"</span>, <span class="st">"married_military_female"</span>, <span class="st">"d"</span>,</span>
<span id="cb92-87"><a href="#cb92-87" aria-hidden="true" tabindex="-1"></a>            <span class="st">"married_civilian_male"</span>, <span class="st">"married_civilian_female"</span>, <span class="st">"d"</span>,</span>
<span id="cb92-88"><a href="#cb92-88" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rep</span>(<span class="st">"d"</span>, <span class="dv">3</span>))</span>
<span id="cb92-89"><a href="#cb92-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-90"><a href="#cb92-90" aria-hidden="true" tabindex="-1"></a><span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">"posts"</span>,<span class="st">"_data"</span>,<span class="st">"ActiveDuty_MaritalStatus.xls"</span>), </span>
<span id="cb92-91"><a href="#cb92-91" aria-hidden="true" tabindex="-1"></a>           <span class="at">skip=</span><span class="dv">8</span>,</span>
<span id="cb92-92"><a href="#cb92-92" aria-hidden="true" tabindex="-1"></a>           <span class="at">col_names =</span> marital_cols)</span>
<span id="cb92-93"><a href="#cb92-93" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-94"><a href="#cb92-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-95"><a href="#cb92-95" aria-hidden="true" tabindex="-1"></a>I can see that the variable names worked well, so this time I will read in the data and omit the original header row, and also filter out the various "TOTAL" rows that we don't need to keep.</span>
<span id="cb92-96"><a href="#cb92-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-97"><a href="#cb92-97" aria-hidden="true" tabindex="-1"></a><span class="fu">### Read in single sheet</span></span>
<span id="cb92-98"><a href="#cb92-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-99"><a href="#cb92-99" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE}</span></span>
<span id="cb92-100"><a href="#cb92-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-101"><a href="#cb92-101" aria-hidden="true" tabindex="-1"></a>military<span class="ot">&lt;-</span><span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">"posts"</span>,<span class="st">"_data"</span>,<span class="st">"ActiveDuty_MaritalStatus.xls"</span>), </span>
<span id="cb92-102"><a href="#cb92-102" aria-hidden="true" tabindex="-1"></a>           <span class="at">skip=</span><span class="dv">9</span>,</span>
<span id="cb92-103"><a href="#cb92-103" aria-hidden="true" tabindex="-1"></a>           <span class="at">col_names =</span> marital_cols</span>
<span id="cb92-104"><a href="#cb92-104" aria-hidden="true" tabindex="-1"></a>           )<span class="sc">%&gt;%</span></span>
<span id="cb92-105"><a href="#cb92-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span><span class="fu">starts_with</span>(<span class="st">"d"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb92-106"><a href="#cb92-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(payGrade_payLevel, <span class="st">"TOTAL"</span>, <span class="at">negate=</span><span class="cn">TRUE</span>))</span>
<span id="cb92-107"><a href="#cb92-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-108"><a href="#cb92-108" aria-hidden="true" tabindex="-1"></a>military</span>
<span id="cb92-109"><a href="#cb92-109" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-110"><a href="#cb92-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-111"><a href="#cb92-111" aria-hidden="true" tabindex="-1"></a>It looks like this worked well! Now we just need to pivot_longer with 3 columns, then separate out the information in the <span class="in">`payGrade_payLevel`</span> variable and do a quick mutate to make paygrade easier to remember.</span>
<span id="cb92-112"><a href="#cb92-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-115"><a href="#cb92-115" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-116"><a href="#cb92-116" aria-hidden="true" tabindex="-1"></a>military_long <span class="ot">&lt;-</span>military <span class="sc">%&gt;%</span></span>
<span id="cb92-117"><a href="#cb92-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb92-118"><a href="#cb92-118" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">"Marital"</span>, <span class="st">"Other"</span>, <span class="st">"Gender"</span>),</span>
<span id="cb92-119"><a href="#cb92-119" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">"_"</span>,</span>
<span id="cb92-120"><a href="#cb92-120" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"count"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb92-121"><a href="#cb92-121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(payGrade_payLevel, </span>
<span id="cb92-122"><a href="#cb92-122" aria-hidden="true" tabindex="-1"></a>           <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"payGrade"</span>, <span class="st">"payLevel"</span>),</span>
<span id="cb92-123"><a href="#cb92-123" aria-hidden="true" tabindex="-1"></a>           <span class="at">sep=</span><span class="st">"-"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb92-124"><a href="#cb92-124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">payGrade =</span> <span class="fu">case_when</span>(</span>
<span id="cb92-125"><a href="#cb92-125" aria-hidden="true" tabindex="-1"></a>    payGrade <span class="sc">==</span> <span class="st">"E"</span> <span class="sc">~</span> <span class="st">"Enlisted"</span>,</span>
<span id="cb92-126"><a href="#cb92-126" aria-hidden="true" tabindex="-1"></a>    payGrade <span class="sc">==</span> <span class="st">"O"</span> <span class="sc">~</span> <span class="st">"Officer"</span>,</span>
<span id="cb92-127"><a href="#cb92-127" aria-hidden="true" tabindex="-1"></a>    payGrade <span class="sc">==</span> <span class="st">"W"</span> <span class="sc">~</span> <span class="st">"Warrant Officer"</span></span>
<span id="cb92-128"><a href="#cb92-128" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb92-129"><a href="#cb92-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-130"><a href="#cb92-130" aria-hidden="true" tabindex="-1"></a>military_long</span>
<span id="cb92-131"><a href="#cb92-131" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-132"><a href="#cb92-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-133"><a href="#cb92-133" aria-hidden="true" tabindex="-1"></a>This all looks like it works well. So now we will go on to creating a function with the steps, then applying it to multiple sheets.</span>
<span id="cb92-134"><a href="#cb92-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-135"><a href="#cb92-135" aria-hidden="true" tabindex="-1"></a><span class="fu">### Create data reading function</span></span>
<span id="cb92-136"><a href="#cb92-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-137"><a href="#cb92-137" aria-hidden="true" tabindex="-1"></a>We will call our new function <span class="in">`read_military`</span>, and we will basically use the exact same commands as above. The big difference is that we will have a placeholder name (or argument) for the data sheet that will be passed to the new function.</span>
<span id="cb92-138"><a href="#cb92-138" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb92-139"><a href="#cb92-139" aria-hidden="true" tabindex="-1"></a>Another difference is that when using <span class="in">`read_excel()`</span> on a workbook with multiple sheets, we need to specify the sheetname of the sheet we wish to read in (we can also specify the sheet name). I then include the <span class="in">`mutate()`</span> command to create a new column called <span class="in">`branch`</span>, which comes from our sheet name.</span>
<span id="cb92-140"><a href="#cb92-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-141"><a href="#cb92-141" aria-hidden="true" tabindex="-1"></a>Everything else will be pretty identical to reading a single sheet - <span class="in">`select(!starts_with("d"))`</span> removes all columns that start with <span class="in">`"d"`</span>. We also filter out the word "Total" from <span class="in">`payGrade_payLevel`</span>. <span class="in">`pivot_longer()`</span>  </span>
<span id="cb92-142"><a href="#cb92-142" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb92-145"><a href="#cb92-145" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-146"><a href="#cb92-146" aria-hidden="true" tabindex="-1"></a>read_military<span class="ot">&lt;-</span><span class="cf">function</span>(sheet_name){</span>
<span id="cb92-147"><a href="#cb92-147" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">"posts"</span>,<span class="st">"_data"</span>,<span class="st">"ActiveDuty_MaritalStatus.xls"</span>), </span>
<span id="cb92-148"><a href="#cb92-148" aria-hidden="true" tabindex="-1"></a>             <span class="at">sheet =</span> sheet_name,</span>
<span id="cb92-149"><a href="#cb92-149" aria-hidden="true" tabindex="-1"></a>             <span class="at">skip=</span><span class="dv">9</span>,</span>
<span id="cb92-150"><a href="#cb92-150" aria-hidden="true" tabindex="-1"></a>             <span class="at">col_names =</span> marital_cols</span>
<span id="cb92-151"><a href="#cb92-151" aria-hidden="true" tabindex="-1"></a>             )<span class="sc">%&gt;%</span></span>
<span id="cb92-152"><a href="#cb92-152" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">"branch"</span><span class="ot">=</span>sheet_name) <span class="sc">%&gt;%</span></span>
<span id="cb92-153"><a href="#cb92-153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span><span class="fu">starts_with</span>(<span class="st">"d"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb92-154"><a href="#cb92-154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(payGrade_payLevel, <span class="st">"TOTAL"</span>, <span class="at">negate=</span><span class="cn">TRUE</span>))<span class="sc">%&gt;%</span></span>
<span id="cb92-155"><a href="#cb92-155" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">contains</span>(<span class="fu">c</span>(<span class="st">"male"</span>, <span class="st">"female"</span>)),</span>
<span id="cb92-156"><a href="#cb92-156" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">"Marital"</span>, <span class="st">"Other"</span>, <span class="st">"Gender"</span>),</span>
<span id="cb92-157"><a href="#cb92-157" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">"_"</span>,</span>
<span id="cb92-158"><a href="#cb92-158" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"count"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb92-159"><a href="#cb92-159" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(payGrade_payLevel, </span>
<span id="cb92-160"><a href="#cb92-160" aria-hidden="true" tabindex="-1"></a>           <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"payGrade"</span>, <span class="st">"payLevel"</span>),</span>
<span id="cb92-161"><a href="#cb92-161" aria-hidden="true" tabindex="-1"></a>           <span class="at">sep=</span><span class="st">"-"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb92-162"><a href="#cb92-162" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">payGrade =</span> <span class="fu">case_when</span>(</span>
<span id="cb92-163"><a href="#cb92-163" aria-hidden="true" tabindex="-1"></a>    payGrade <span class="sc">==</span> <span class="st">"E"</span> <span class="sc">~</span> <span class="st">"Enlisted"</span>,</span>
<span id="cb92-164"><a href="#cb92-164" aria-hidden="true" tabindex="-1"></a>    payGrade <span class="sc">==</span> <span class="st">"O"</span> <span class="sc">~</span> <span class="st">"Officer"</span>,</span>
<span id="cb92-165"><a href="#cb92-165" aria-hidden="true" tabindex="-1"></a>    payGrade <span class="sc">==</span> <span class="st">"W"</span> <span class="sc">~</span> <span class="st">"Warrant Officer"</span></span>
<span id="cb92-166"><a href="#cb92-166" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb92-167"><a href="#cb92-167" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb92-168"><a href="#cb92-168" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-169"><a href="#cb92-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-170"><a href="#cb92-170" aria-hidden="true" tabindex="-1"></a><span class="fu">### Purrr to join</span></span>
<span id="cb92-171"><a href="#cb92-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-172"><a href="#cb92-172" aria-hidden="true" tabindex="-1"></a>We now have a function that is customized to read in the mmilitary active duty marital status sheets. We just need to use <span class="in">`purrr`</span> - a package that is part of tidyverse but which may need to be installed and loaded on its own - to iterate through the list of sheets in the workbook.</span>
<span id="cb92-173"><a href="#cb92-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-176"><a href="#cb92-176" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-177"><a href="#cb92-177" aria-hidden="true" tabindex="-1"></a>military_sheets<span class="ot">&lt;-</span><span class="fu">excel_sheets</span>(<span class="fu">here</span>(<span class="st">"posts"</span>,<span class="st">"_data"</span>,<span class="st">"ActiveDuty_MaritalStatus.xls"</span>) )</span>
<span id="cb92-178"><a href="#cb92-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-179"><a href="#cb92-179" aria-hidden="true" tabindex="-1"></a>military_sheets</span>
<span id="cb92-180"><a href="#cb92-180" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-181"><a href="#cb92-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-182"><a href="#cb92-182" aria-hidden="true" tabindex="-1"></a>Now we have a list of sheet names to map with the function. Typically, a purrr::map function creates a list of data frames with each element in the original vector fed to the function as a single list element, as depicted below.</span>
<span id="cb92-183"><a href="#cb92-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-186"><a href="#cb92-186" aria-hidden="true" tabindex="-1"></a><span class="in">```{mermaid}</span></span>
<span id="cb92-187"><a href="#cb92-187" aria-hidden="true" tabindex="-1"></a>%%| fig<span class="ot">-c</span>ap: Purrring Military Workbook</span>
<span id="cb92-188"><a href="#cb92-188" aria-hidden="true" tabindex="-1"></a>flowchart LR</span>
<span id="cb92-189"><a href="#cb92-189" aria-hidden="true" tabindex="-1"></a>  subgraph Excel</span>
<span id="cb92-190"><a href="#cb92-190" aria-hidden="true" tabindex="-1"></a>    A[Airforce] --&gt; E{Read military}</span>
<span id="cb92-191"><a href="#cb92-191" aria-hidden="true" tabindex="-1"></a>    B[MarineCorp] --&gt; E</span>
<span id="cb92-192"><a href="#cb92-192" aria-hidden="true" tabindex="-1"></a>    C[Navy] --&gt; E</span>
<span id="cb92-193"><a href="#cb92-193" aria-hidden="true" tabindex="-1"></a>    D[Army] --&gt; E</span>
<span id="cb92-194"><a href="#cb92-194" aria-hidden="true" tabindex="-1"></a>  end</span>
<span id="cb92-195"><a href="#cb92-195" aria-hidden="true" tabindex="-1"></a>  subgraph R.List</span>
<span id="cb92-196"><a href="#cb92-196" aria-hidden="true" tabindex="-1"></a>    E --&gt; F(<span class="ot">"</span><span class="st">list[[1]], branch==airforce</span><span class="ot">"</span>)</span>
<span id="cb92-197"><a href="#cb92-197" aria-hidden="true" tabindex="-1"></a>    E --&gt; G(<span class="ot">"</span><span class="st">list[[2]], branch==marines</span><span class="ot">"</span>)</span>
<span id="cb92-198"><a href="#cb92-198" aria-hidden="true" tabindex="-1"></a>    E --&gt; H(<span class="ot">"</span><span class="st">list[[3]], branch==navy</span><span class="ot">"</span>)</span>
<span id="cb92-199"><a href="#cb92-199" aria-hidden="true" tabindex="-1"></a>    E --&gt; I(<span class="ot">"</span><span class="st">list[[4]], branch==army</span><span class="ot">"</span>)</span>
<span id="cb92-200"><a href="#cb92-200" aria-hidden="true" tabindex="-1"></a>  end</span>
<span id="cb92-201"><a href="#cb92-201" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-202"><a href="#cb92-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-203"><a href="#cb92-203" aria-hidden="true" tabindex="-1"></a>We are going to use <span class="in">`map_dfr()`</span> to join the four elements of the list into a single dataframe. <span class="in">`map`</span> is the generic <span class="in">`purrr`</span> function, and adding on the <span class="in">`dfr`</span> means that we want to turn all of the list elements created by <span class="in">`map`</span> into a single datafame (df) that is joined by rows (r). </span>
<span id="cb92-204"><a href="#cb92-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-205"><a href="#cb92-205" aria-hidden="true" tabindex="-1"></a>:::{.callout-tip}</span>
<span id="cb92-206"><a href="#cb92-206" aria-hidden="true" tabindex="-1"></a><span class="fu">## using `map_dfr`</span></span>
<span id="cb92-207"><a href="#cb92-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-208"><a href="#cb92-208" aria-hidden="true" tabindex="-1"></a>There are functions in <span class="in">`purrr`</span> that automatically convert the list created by map into the dataframe shape that you want, but you need to be careful that the objects being mapped have the correct column names (or rows, if you are using <span class="in">`map_dfc()`</span> to avoid errors. Plain <span class="in">`map`</span> is the safe option, but you then have to manually join the data.)</span>
<span id="cb92-209"><a href="#cb92-209" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb92-210"><a href="#cb92-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-213"><a href="#cb92-213" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-214"><a href="#cb92-214" aria-hidden="true" tabindex="-1"></a>military_all <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(</span>
<span id="cb92-215"><a href="#cb92-215" aria-hidden="true" tabindex="-1"></a>  <span class="fu">excel_sheets</span>(<span class="fu">here</span>(<span class="st">"posts"</span>,<span class="st">"_data"</span>,<span class="st">"ActiveDuty_MaritalStatus.xls"</span>))[<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>],</span>
<span id="cb92-216"><a href="#cb92-216" aria-hidden="true" tabindex="-1"></a>  read_military)</span>
<span id="cb92-217"><a href="#cb92-217" aria-hidden="true" tabindex="-1"></a>military_all</span>
<span id="cb92-218"><a href="#cb92-218" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-219"><a href="#cb92-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-220"><a href="#cb92-220" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb92-221"><a href="#cb92-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-222"><a href="#cb92-222" aria-hidden="true" tabindex="-1"></a><span class="fu">## FAOstat Regions</span></span>
<span id="cb92-223"><a href="#cb92-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-224"><a href="#cb92-224" aria-hidden="true" tabindex="-1"></a>The FAOSTAT sheets are excerpts of the <span class="co">[</span><span class="ot">FAOSTAT database</span><span class="co">](https://www.fao.org/faostat/en/#home)</span> provided by the <span class="co">[</span><span class="ot">Food and Agriculture Association</span><span class="co">](https://www.fao.org/home/en)</span>, an agency of the United Nations. There are two approaches we could use to joining these data. In this section, we are going to join livestock estimates from a single file to regional codes for the countries. </span>
<span id="cb92-225"><a href="#cb92-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-226"><a href="#cb92-226" aria-hidden="true" tabindex="-1"></a>The file *birds.csv* that includes estimates of the stock of five different types of poultry (Chickens, Ducks, Geese and guinea fowls, Turkeys, and Pigeons/Others) in 248 areas for 58 years between 1961-2018. Because we know (from challenge 1) that several of those areas include aggregated data (e.g., ) we are going to remove the aggregations and replace the case level aggregations with the correct grouping variables from the file "FAOSTAT_country_groups.csv", downloaded from <span class="co">[</span><span class="ot">Country Region definitions</span><span class="co">](https://www.fao.org/faostat/en/#definitions)</span> provided by the FAO. As a reminder, I am going to split the original birds data into country level and aggregated data, and then list the aggregated groups we found in Challenge 1.</span>
<span id="cb92-227"><a href="#cb92-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-230"><a href="#cb92-230" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-231"><a href="#cb92-231" aria-hidden="true" tabindex="-1"></a>birds_orig<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"posts"</span>,<span class="st">"_data"</span>,<span class="st">"birds.csv"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb92-232"><a href="#cb92-232" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">contains</span>(<span class="st">"Code"</span>))</span>
<span id="cb92-233"><a href="#cb92-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-234"><a href="#cb92-234" aria-hidden="true" tabindex="-1"></a>birds_agg<span class="ot">&lt;-</span>birds_orig<span class="sc">%&gt;%</span></span>
<span id="cb92-235"><a href="#cb92-235" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Flag<span class="sc">==</span><span class="st">"A"</span>)</span>
<span id="cb92-236"><a href="#cb92-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-237"><a href="#cb92-237" aria-hidden="true" tabindex="-1"></a>birds<span class="ot">&lt;-</span>birds_orig<span class="sc">%&gt;%</span></span>
<span id="cb92-238"><a href="#cb92-238" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Flag<span class="sc">!=</span><span class="st">"A"</span>)</span>
<span id="cb92-239"><a href="#cb92-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-240"><a href="#cb92-240" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(birds_agg<span class="sc">$</span>Area)</span>
<span id="cb92-241"><a href="#cb92-241" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-242"><a href="#cb92-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-243"><a href="#cb92-243" aria-hidden="true" tabindex="-1"></a>With the FAO regional information, we can find out which countries are in which regions:</span>
<span id="cb92-244"><a href="#cb92-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-247"><a href="#cb92-247" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-248"><a href="#cb92-248" aria-hidden="true" tabindex="-1"></a><span class="co">#| column: page</span></span>
<span id="cb92-249"><a href="#cb92-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-250"><a href="#cb92-250" aria-hidden="true" tabindex="-1"></a>fao_regions_orig <span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="st">"_data/FAOSTAT_country_groups.csv"</span>)</span>
<span id="cb92-251"><a href="#cb92-251" aria-hidden="true" tabindex="-1"></a>fao_regions<span class="ot">&lt;-</span>fao_regions_orig<span class="sc">%&gt;%</span></span>
<span id="cb92-252"><a href="#cb92-252" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">Country Group</span><span class="st">`</span>, Country)<span class="sc">%&gt;%</span></span>
<span id="cb92-253"><a href="#cb92-253" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">country_group =</span> <span class="st">`</span><span class="at">Country Group</span><span class="st">`</span>)<span class="sc">%&gt;%</span></span>
<span id="cb92-254"><a href="#cb92-254" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb92-255"><a href="#cb92-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-256"><a href="#cb92-256" aria-hidden="true" tabindex="-1"></a>fao_regions<span class="sc">%&gt;%</span></span>
<span id="cb92-257"><a href="#cb92-257" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country_group <span class="sc">==</span> <span class="st">"Polynesia"</span>)</span>
<span id="cb92-258"><a href="#cb92-258" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-259"><a href="#cb92-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-260"><a href="#cb92-260" aria-hidden="true" tabindex="-1"></a>Clearly, some of the groups might overlap. For example, one group is called World and clearly overlaps with all other groups. So, before we join, lets remove the World group and then inspect the country-region pairings to ensure there are no other overlaps.</span>
<span id="cb92-261"><a href="#cb92-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-264"><a href="#cb92-264" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-265"><a href="#cb92-265" aria-hidden="true" tabindex="-1"></a>temp<span class="ot">&lt;-</span>fao_regions<span class="sc">%&gt;%</span></span>
<span id="cb92-266"><a href="#cb92-266" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country_group)<span class="sc">%&gt;%</span></span>
<span id="cb92-267"><a href="#cb92-267" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n=</span><span class="fu">n</span>())<span class="sc">%&gt;%</span></span>
<span id="cb92-268"><a href="#cb92-268" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n))</span>
<span id="cb92-269"><a href="#cb92-269" aria-hidden="true" tabindex="-1"></a>half <span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">round</span>(<span class="fu">nrow</span>(temp)<span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb92-270"><a href="#cb92-270" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">list</span>(temp[half,],  </span>
<span id="cb92-271"><a href="#cb92-271" aria-hidden="true" tabindex="-1"></a>           <span class="fu">matrix</span>(<span class="fu">numeric</span>(), <span class="at">nrow=</span><span class="dv">0</span>, <span class="at">ncol=</span><span class="dv">1</span>),</span>
<span id="cb92-272"><a href="#cb92-272" aria-hidden="true" tabindex="-1"></a>           temp[<span class="sc">-</span>half,]), </span>
<span id="cb92-273"><a href="#cb92-273" aria-hidden="true" tabindex="-1"></a>           <span class="at">caption =</span> <span class="st">"Countries in Country Groups"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb92-274"><a href="#cb92-274" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(<span class="at">font_size=</span><span class="dv">12</span>)</span>
<span id="cb92-275"><a href="#cb92-275" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-276"><a href="#cb92-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-277"><a href="#cb92-277" aria-hidden="true" tabindex="-1"></a>Unfortunately, we can see that many regions must overlap - which is super annoying. We need to essentially extract the country-level or regional groupings - of which there seem to be up to 7 or 8 - potentially nested or perhaps not - country grouping categories - to fully disentangle the various aggregations contained in the original data. The demonstration below quickly identifies four major grouping categories to extract and confirms that there are approximately 277 countries (or less) in each grouping category. More detailed work could be used to nest sub-regions within regions (e.g., Eastern Europe would nest within Europe, and so on.)</span>
<span id="cb92-278"><a href="#cb92-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-281"><a href="#cb92-281" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-282"><a href="#cb92-282" aria-hidden="true" tabindex="-1"></a>fao_regions<span class="sc">%&gt;%</span></span>
<span id="cb92-283"><a href="#cb92-283" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>())<span class="sc">/</span><span class="dv">277</span></span>
<span id="cb92-284"><a href="#cb92-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-285"><a href="#cb92-285" aria-hidden="true" tabindex="-1"></a>fao_regions<span class="sc">%&gt;%</span></span>
<span id="cb92-286"><a href="#cb92-286" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(country_group, <span class="st">"[aA]nnex"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb92-287"><a href="#cb92-287" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country_group)<span class="sc">%&gt;%</span></span>
<span id="cb92-288"><a href="#cb92-288" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>())</span>
<span id="cb92-289"><a href="#cb92-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-290"><a href="#cb92-290" aria-hidden="true" tabindex="-1"></a>fao_regions<span class="sc">%&gt;%</span></span>
<span id="cb92-291"><a href="#cb92-291" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(country_group, <span class="st">"[aA]nnex"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb92-292"><a href="#cb92-292" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>())</span>
<span id="cb92-293"><a href="#cb92-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-294"><a href="#cb92-294" aria-hidden="true" tabindex="-1"></a>fao_regions<span class="sc">%&gt;%</span></span>
<span id="cb92-295"><a href="#cb92-295" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(country_group, <span class="st">"[iI]ncome"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb92-296"><a href="#cb92-296" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country_group)<span class="sc">%&gt;%</span></span>
<span id="cb92-297"><a href="#cb92-297" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>())</span>
<span id="cb92-298"><a href="#cb92-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-299"><a href="#cb92-299" aria-hidden="true" tabindex="-1"></a>fao_regions<span class="sc">%&gt;%</span></span>
<span id="cb92-300"><a href="#cb92-300" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(country_group, <span class="st">"[iI]ncome"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb92-301"><a href="#cb92-301" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>())</span>
<span id="cb92-302"><a href="#cb92-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-303"><a href="#cb92-303" aria-hidden="true" tabindex="-1"></a>fao_regions<span class="sc">%&gt;%</span></span>
<span id="cb92-304"><a href="#cb92-304" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(country_group, <span class="st">"[Dd]evelop|OECD"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb92-305"><a href="#cb92-305" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country_group)<span class="sc">%&gt;%</span></span>
<span id="cb92-306"><a href="#cb92-306" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>())</span>
<span id="cb92-307"><a href="#cb92-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-308"><a href="#cb92-308" aria-hidden="true" tabindex="-1"></a>fao_regions<span class="sc">%&gt;%</span></span>
<span id="cb92-309"><a href="#cb92-309" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(country_group, <span class="st">"[Dd]evelop|OECD"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb92-310"><a href="#cb92-310" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>())</span>
<span id="cb92-311"><a href="#cb92-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-312"><a href="#cb92-312" aria-hidden="true" tabindex="-1"></a>major_regions<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"Africa"</span>, <span class="st">"Asia"</span>, <span class="st">"Europe"</span>, <span class="st">"Americas"</span>, </span>
<span id="cb92-313"><a href="#cb92-313" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"Oceania"</span>, <span class="st">"Antarctic Region"</span>)</span>
<span id="cb92-314"><a href="#cb92-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-315"><a href="#cb92-315" aria-hidden="true" tabindex="-1"></a>fao_regions<span class="sc">%&gt;%</span></span>
<span id="cb92-316"><a href="#cb92-316" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country_group <span class="sc">%in%</span> major_regions)<span class="sc">%&gt;%</span></span>
<span id="cb92-317"><a href="#cb92-317" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>())</span>
<span id="cb92-318"><a href="#cb92-318" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-319"><a href="#cb92-319" aria-hidden="true" tabindex="-1"></a>We now use the <span class="in">`unite`</span> command to create four new categorical variables corresponding to the four country groupings we have identified that contain most or all of the 277 countries included in the data.</span>
<span id="cb92-320"><a href="#cb92-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-323"><a href="#cb92-323" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-324"><a href="#cb92-324" aria-hidden="true" tabindex="-1"></a>fao_regions_wide<span class="ot">&lt;-</span>fao_regions<span class="sc">%&gt;%</span></span>
<span id="cb92-325"><a href="#cb92-325" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country_group<span class="sc">!=</span><span class="st">"World"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb92-326"><a href="#cb92-326" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from=</span>country_group, <span class="at">values_from =</span> <span class="dv">1</span>)<span class="sc">%&gt;%</span></span>
<span id="cb92-327"><a href="#cb92-327" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(<span class="st">"gp_annex"</span>, <span class="fu">contains</span>(<span class="st">"Annex"</span>), </span>
<span id="cb92-328"><a href="#cb92-328" aria-hidden="true" tabindex="-1"></a>        <span class="at">sep=</span><span class="st">""</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>, <span class="at">remove=</span><span class="cn">TRUE</span>)<span class="sc">%&gt;%</span></span>
<span id="cb92-329"><a href="#cb92-329" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(<span class="st">"gp_major_region"</span>, <span class="fu">any_of</span>(major_regions), </span>
<span id="cb92-330"><a href="#cb92-330" aria-hidden="true" tabindex="-1"></a>        <span class="at">sep=</span><span class="st">""</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>, <span class="at">remove=</span><span class="cn">TRUE</span>)<span class="sc">%&gt;%</span></span>
<span id="cb92-331"><a href="#cb92-331" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(<span class="st">"gp_income"</span>, <span class="fu">contains</span>(<span class="st">"Income"</span>)<span class="sc">|</span><span class="fu">contains</span>(<span class="st">"income"</span>),</span>
<span id="cb92-332"><a href="#cb92-332" aria-hidden="true" tabindex="-1"></a>        <span class="at">sep=</span><span class="st">""</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>, <span class="at">remove=</span><span class="cn">TRUE</span>)<span class="sc">%&gt;%</span></span>
<span id="cb92-333"><a href="#cb92-333" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(<span class="st">"gp_develop"</span>, <span class="fu">contains</span>(<span class="st">"Develop"</span>)<span class="sc">|</span><span class="fu">contains</span>(<span class="st">"OECD"</span>),</span>
<span id="cb92-334"><a href="#cb92-334" aria-hidden="true" tabindex="-1"></a>        <span class="at">sep=</span><span class="st">""</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>, <span class="at">remove=</span><span class="cn">TRUE</span>)<span class="sc">%&gt;%</span></span>
<span id="cb92-335"><a href="#cb92-335" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Country, <span class="fu">starts_with</span>(<span class="st">"gp"</span>))</span>
<span id="cb92-336"><a href="#cb92-336" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-337"><a href="#cb92-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-338"><a href="#cb92-338" aria-hidden="true" tabindex="-1"></a><span class="fu">### Join to livestock data</span></span>
<span id="cb92-339"><a href="#cb92-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-340"><a href="#cb92-340" aria-hidden="true" tabindex="-1"></a>Now that we have countries and four regional breakdown indicators, we can join this data to our original livestock data by countryname. I am going to do a left_join, as each case includes a country, and we want to match countries to join the four regional indicators. Because the *Country* variable is described as *Area* in the original birds data, we want to explicitly set the two key fields for the join.</span>
<span id="cb92-341"><a href="#cb92-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-342"><a href="#cb92-342" aria-hidden="true" tabindex="-1"></a>We should end up with the same number of rows in the "birds" data as we started off with. An <span class="in">`inner_join`</span> would also work in this case, would effectively omit from the left-hand side data any aggregated cases left in by mistake (it would only keep rows where "Area" matched one of the "Country" values.)</span>
<span id="cb92-343"><a href="#cb92-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-346"><a href="#cb92-346" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-347"><a href="#cb92-347" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(birds)</span>
<span id="cb92-348"><a href="#cb92-348" aria-hidden="true" tabindex="-1"></a>birds <span class="ot">&lt;-</span> <span class="fu">left_join</span>(birds, fao_regions_wide,</span>
<span id="cb92-349"><a href="#cb92-349" aria-hidden="true" tabindex="-1"></a>                   <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"Area"</span> <span class="ot">=</span> <span class="st">"Country"</span>))</span>
<span id="cb92-350"><a href="#cb92-350" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-351"><a href="#cb92-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-352"><a href="#cb92-352" aria-hidden="true" tabindex="-1"></a>Now, you can summarize across countries grouped by income, development status, major region, or Annex/non-Annex.</span>
<span id="cb92-353"><a href="#cb92-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-356"><a href="#cb92-356" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-357"><a href="#cb92-357" aria-hidden="true" tabindex="-1"></a>eggs_chicken <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">"posts"</span>,<span class="st">"_data"</span>,<span class="st">"FAOSTAT_egg_chicken.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-358"><a href="#cb92-358" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>()</span>
<span id="cb92-359"><a href="#cb92-359" aria-hidden="true" tabindex="-1"></a>cattle <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">"posts"</span>,<span class="st">"_data"</span>,<span class="st">"FAOSTAT_egg_chicken.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-360"><a href="#cb92-360" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>()</span>
<span id="cb92-361"><a href="#cb92-361" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">left_join</span>(eggs_chicken, cattle, <span class="at">by=</span><span class="st">"Area"</span>)</span>
<span id="cb92-362"><a href="#cb92-362" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-363"><a href="#cb92-363" aria-hidden="true" tabindex="-1"></a><span class="fu">## FAOstat: Regions</span></span>
<span id="cb92-364"><a href="#cb92-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-365"><a href="#cb92-365" aria-hidden="true" tabindex="-1"></a>The FAOSTAT sheets are excerpts of the <span class="co">[</span><span class="ot">FAOSTAT database</span><span class="co">](https://www.fao.org/faostat/en/#home)</span> provided by the <span class="co">[</span><span class="ot">Food and Agriculture Association</span><span class="co">](https://www.fao.org/home/en)</span>, an agency of the United Nations. There are two approaches we could use to joining these data. In this section, we are going to join livestock estimates from multiple "faostat..." files. </span>
<span id="cb92-366"><a href="#cb92-366" aria-hidden="true" tabindex="-1"></a>                                                            </span>
<span id="cb92-367"><a href="#cb92-367" aria-hidden="true" tabindex="-1"></a>We have already seen that the file *birds.csv* includes estimates of the stock of five different types of poultry (Chickens, Ducks, Geese and guinea fowls, Turkeys, and Pigeons/Others) in 248 areas for 58 years between 1961-2018. What about the other "FAOSTAT_<span class="sc">\*</span>" files? </span>
<span id="cb92-368"><a href="#cb92-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-369"><a href="#cb92-369" aria-hidden="true" tabindex="-1"></a>Lets read them into a single list, and see what we find. First, lets write a function to just read in the file and then print out the column names.</span>
<span id="cb92-370"><a href="#cb92-370" aria-hidden="true" tabindex="-1"></a>                                                          </span>
<span id="cb92-371"><a href="#cb92-371" aria-hidden="true" tabindex="-1"></a>:::{.callout-tip}</span>
<span id="cb92-372"><a href="#cb92-372" aria-hidden="true" tabindex="-1"></a><span class="fu">## list.files()</span></span>
<span id="cb92-373"><a href="#cb92-373" aria-hidden="true" tabindex="-1"></a>                                                          </span>
<span id="cb92-374"><a href="#cb92-374" aria-hidden="true" tabindex="-1"></a>There are base R functions that allow you to easily interact with the underlying system, just like you would at the command line or in the terminal. One of my favorites is <span class="in">`list.files()`</span>, which does exactly what it says on the tin! The pattern matching used in the terminal may vary slightly depending on your operating system.</span>
<span id="cb92-375"><a href="#cb92-375" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb92-376"><a href="#cb92-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-379"><a href="#cb92-379" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-380"><a href="#cb92-380" aria-hidden="true" tabindex="-1"></a>read_faostat<span class="ot">&lt;-</span><span class="cf">function</span>(fn){</span>
<span id="cb92-381"><a href="#cb92-381" aria-hidden="true" tabindex="-1"></a>  fao<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="fu">str_c</span>(<span class="fu">here</span>(<span class="st">"posts"</span>,<span class="st">"_data"</span>), fn, <span class="at">sep=</span><span class="st">"/"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb92-382"><a href="#cb92-382" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">contains</span>(<span class="st">"Code"</span>))</span>
<span id="cb92-383"><a href="#cb92-383" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb92-384"><a href="#cb92-384" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">colnames</span>(fao))</span>
<span id="cb92-385"><a href="#cb92-385" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb92-386"><a href="#cb92-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-387"><a href="#cb92-387" aria-hidden="true" tabindex="-1"></a>fao_files<span class="ot">&lt;-</span><span class="fu">list.files</span>(<span class="at">path=</span><span class="fu">here</span>(<span class="st">"posts"</span>,<span class="st">"_data"</span>), <span class="at">pattern=</span><span class="st">"FAOSTAT*"</span>)</span>
<span id="cb92-388"><a href="#cb92-388" aria-hidden="true" tabindex="-1"></a>fao_files[<span class="dv">2</span>]<span class="ot">&lt;-</span><span class="st">"birds.csv"</span></span>
<span id="cb92-389"><a href="#cb92-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-390"><a href="#cb92-390" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(fao_files, read_faostat)</span>
<span id="cb92-391"><a href="#cb92-391" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-392"><a href="#cb92-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-393"><a href="#cb92-393" aria-hidden="true" tabindex="-1"></a>We can see from this that the column names are identical in the four datasets, which makes them easy to merge. Additionally, we suspect from the *birds* dataset that the *Domain* variable will uniquely identify the dataset, lets see if we are correct by modifying our <span class="in">`read_faostat`</span> function.</span>
<span id="cb92-394"><a href="#cb92-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-397"><a href="#cb92-397" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-398"><a href="#cb92-398" aria-hidden="true" tabindex="-1"></a>read_faostat<span class="ot">&lt;-</span><span class="cf">function</span>(fn){</span>
<span id="cb92-399"><a href="#cb92-399" aria-hidden="true" tabindex="-1"></a>  fao<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="fu">str_c</span>(<span class="fu">here</span>(<span class="st">"posts"</span>,<span class="st">"_data"</span>), fn, <span class="at">sep=</span><span class="st">"/"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb92-400"><a href="#cb92-400" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">contains</span>(<span class="st">"Code"</span>))</span>
<span id="cb92-401"><a href="#cb92-401" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb92-402"><a href="#cb92-402" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">Domain =</span> <span class="fu">unique</span>(fao<span class="sc">$</span>Domain),</span>
<span id="cb92-403"><a href="#cb92-403" aria-hidden="true" tabindex="-1"></a>              <span class="at">Elements =</span> <span class="fu">unique</span>(fao<span class="sc">$</span>Element),</span>
<span id="cb92-404"><a href="#cb92-404" aria-hidden="true" tabindex="-1"></a>              <span class="at">Items =</span> <span class="fu">unique</span>(fao<span class="sc">$</span>Item),</span>
<span id="cb92-405"><a href="#cb92-405" aria-hidden="true" tabindex="-1"></a>              <span class="at">obs =</span> <span class="fu">nrow</span>(fao)))</span>
<span id="cb92-406"><a href="#cb92-406" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb92-407"><a href="#cb92-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-408"><a href="#cb92-408" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(fao_files, read_faostat)</span>
<span id="cb92-409"><a href="#cb92-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-410"><a href="#cb92-410" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-411"><a href="#cb92-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-412"><a href="#cb92-412" aria-hidden="true" tabindex="-1"></a>What an easy way to learn a lot about the data quickly. Sure enough, we can now merge the data back together and have way too much information in the same R object :-) This time, we will modify the <span class="in">`read_faostat`</span> function to only read in the data, and then use <span class="in">`purrr::map_dfr()`</span> to join.</span>
<span id="cb92-413"><a href="#cb92-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-416"><a href="#cb92-416" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-417"><a href="#cb92-417" aria-hidden="true" tabindex="-1"></a>read_faostat<span class="ot">&lt;-</span><span class="cf">function</span>(fn){</span>
<span id="cb92-418"><a href="#cb92-418" aria-hidden="true" tabindex="-1"></a>  fao<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="fu">str_c</span>(<span class="fu">here</span>(<span class="st">"posts"</span>,<span class="st">"_data"</span>), fn, <span class="at">sep=</span><span class="st">"/"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb92-419"><a href="#cb92-419" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">contains</span>(<span class="st">"Code"</span>))</span>
<span id="cb92-420"><a href="#cb92-420" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(fao)</span>
<span id="cb92-421"><a href="#cb92-421" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb92-422"><a href="#cb92-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-423"><a href="#cb92-423" aria-hidden="true" tabindex="-1"></a>faostat<span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(fao_files, read_faostat)<span class="sc">%&gt;%</span></span>
<span id="cb92-424"><a href="#cb92-424" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(fao_regions_wide, </span>
<span id="cb92-425"><a href="#cb92-425" aria-hidden="true" tabindex="-1"></a>             <span class="at">by=</span><span class="fu">c</span>(<span class="st">"Area"</span> <span class="ot">=</span> <span class="st">"Country"</span>))</span>
<span id="cb92-426"><a href="#cb92-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-427"><a href="#cb92-427" aria-hidden="true" tabindex="-1"></a>faostat</span>
<span id="cb92-428"><a href="#cb92-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-429"><a href="#cb92-429" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-430"><a href="#cb92-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-431"><a href="#cb92-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-432"><a href="#cb92-432" aria-hidden="true" tabindex="-1"></a><span class="fu">## SNL</span></span>
<span id="cb92-433"><a href="#cb92-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-434"><a href="#cb92-434" aria-hidden="true" tabindex="-1"></a><span class="fu">## The Data  </span></span>
<span id="cb92-435"><a href="#cb92-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-436"><a href="#cb92-436" aria-hidden="true" tabindex="-1"></a>These data came to my attention courtesy of Jeremy Singer-Vine's wonderful <span class="co">[</span><span class="ot">Data is Plural</span><span class="co">](data-is-plural.com)</span> newsletter. <span class="co">[</span><span class="ot">These datasets</span><span class="co">](https://github.com/hhllcks/snldb)</span>, archived by Joel Navaroli and scraped by Hendrik Hilleckes and Colin Morris, contain data about the actors, cast, seasons, etc. from every season of Saturday Night Live from its inception through 2020.  </span>
<span id="cb92-437"><a href="#cb92-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-438"><a href="#cb92-438" aria-hidden="true" tabindex="-1"></a>We will be working with three data files: <span class="in">`actors.csv`</span>, <span class="in">`casts.csv`</span>, and <span class="in">`seasons.csv`</span>. </span>
<span id="cb92-439"><a href="#cb92-439" aria-hidden="true" tabindex="-1"></a>Before we read in the data, we'll need to load the <span class="in">`dplyr`</span>, <span class="in">`tidyr`</span>, <span class="in">`ggplot2`</span>, and <span class="in">`readr`</span> packages.  </span>
<span id="cb92-440"><a href="#cb92-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-443"><a href="#cb92-443" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-444"><a href="#cb92-444" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false </span></span>
<span id="cb92-445"><a href="#cb92-445" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false </span></span>
<span id="cb92-446"><a href="#cb92-446" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb92-447"><a href="#cb92-447" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb92-448"><a href="#cb92-448" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb92-449"><a href="#cb92-449" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb92-450"><a href="#cb92-450" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-451"><a href="#cb92-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-452"><a href="#cb92-452" aria-hidden="true" tabindex="-1"></a>Now let's read in the data.  </span>
<span id="cb92-453"><a href="#cb92-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-456"><a href="#cb92-456" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-457"><a href="#cb92-457" aria-hidden="true" tabindex="-1"></a>actors <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"posts"</span>,<span class="st">"_data"</span>,<span class="st">"snl_actors.csv"</span>))</span>
<span id="cb92-458"><a href="#cb92-458" aria-hidden="true" tabindex="-1"></a>casts <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"posts"</span>,<span class="st">"_data"</span>,<span class="st">"snl_casts.csv"</span>))</span>
<span id="cb92-459"><a href="#cb92-459" aria-hidden="true" tabindex="-1"></a>seasons <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"posts"</span>,<span class="st">"_data"</span>,<span class="st">"snl_seasons.csv"</span>))</span>
<span id="cb92-460"><a href="#cb92-460" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-461"><a href="#cb92-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-464"><a href="#cb92-464" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-465"><a href="#cb92-465" aria-hidden="true" tabindex="-1"></a>rmarkdown<span class="sc">::</span><span class="fu">paged_table</span>(actors)</span>
<span id="cb92-466"><a href="#cb92-466" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-467"><a href="#cb92-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-470"><a href="#cb92-470" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-471"><a href="#cb92-471" aria-hidden="true" tabindex="-1"></a>rmarkdown<span class="sc">::</span><span class="fu">paged_table</span>(casts)</span>
<span id="cb92-472"><a href="#cb92-472" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-473"><a href="#cb92-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-476"><a href="#cb92-476" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-477"><a href="#cb92-477" aria-hidden="true" tabindex="-1"></a>rmarkdown<span class="sc">::</span><span class="fu">paged_table</span>(seasons)</span>
<span id="cb92-478"><a href="#cb92-478" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-479"><a href="#cb92-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-480"><a href="#cb92-480" aria-hidden="true" tabindex="-1"></a><span class="fu">## Analysis  </span></span>
<span id="cb92-481"><a href="#cb92-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-482"><a href="#cb92-482" aria-hidden="true" tabindex="-1"></a>We're going to be focusing on how the gender makeup of the SNL cast has changed over time. There's a well-known bias in the entertainment industry in favor of male performers, particularly in comedy. We'll be examining the data to see how/if SNL exhibits such a bias as well as how it has evolved over the years.</span>
<span id="cb92-483"><a href="#cb92-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-484"><a href="#cb92-484" aria-hidden="true" tabindex="-1"></a>The <span class="in">`casts`</span> dataframe contains data about each cast member from each seasons. However, it does not contain any information about the cast members' gender, which is stored in the <span class="in">`actors`</span> dataframe. In turn, the <span class="in">`actors`</span> dataframe contains no information about the seasons in which the cast members appeared.</span>
<span id="cb92-485"><a href="#cb92-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-486"><a href="#cb92-486" aria-hidden="true" tabindex="-1"></a>We will use <span class="in">`left_join()`</span> to merge these two data sets, by <span class="in">`aid`</span> (actor ID). We also use <span class="in">`filter()`</span> to remove all guest stars and crew members from the <span class="in">`actors`</span> data frame. Then, we use <span class="in">`count()`</span> to tally the gender makeup of season.</span>
<span id="cb92-487"><a href="#cb92-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-490"><a href="#cb92-490" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-491"><a href="#cb92-491" aria-hidden="true" tabindex="-1"></a>casts_gender_count <span class="ot">&lt;-</span> casts  <span class="sc">%&gt;%</span></span>
<span id="cb92-492"><a href="#cb92-492" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">filter</span>(actors,type<span class="sc">==</span><span class="st">"cast"</span>),</span>
<span id="cb92-493"><a href="#cb92-493" aria-hidden="true" tabindex="-1"></a>            <span class="at">by=</span><span class="st">"aid"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-494"><a href="#cb92-494" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sid,gender)</span>
<span id="cb92-495"><a href="#cb92-495" aria-hidden="true" tabindex="-1"></a>rmarkdown<span class="sc">::</span><span class="fu">paged_table</span>(casts_gender_count)</span>
<span id="cb92-496"><a href="#cb92-496" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-497"><a href="#cb92-497" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb92-498"><a href="#cb92-498" aria-hidden="true" tabindex="-1"></a>We now have a nice dataframe containing the counts of each unique gender from each season of Saturday Night Live. </span>
<span id="cb92-499"><a href="#cb92-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-500"><a href="#cb92-500" aria-hidden="true" tabindex="-1"></a>Next, we perform a number of operations on the data. First, we use <span class="in">`group_by()`</span> and <span class="in">`mutate()`</span> to compute the proportion of gender per season. Some seasons only have <span class="in">`"male"`</span> and <span class="in">`"female"`</span> as the unique genders, while others have <span class="in">`"male"`</span>, <span class="in">`"female"`</span>, <span class="in">`"other"`</span>, and "<span class="in">`NA"`</span>. We want to include all available levels of <span class="in">`gender`</span> for each season. To do so, we need to use <span class="in">`pivot_wider()`</span>, <span class="in">`mutate()`</span>, and <span class="in">`replace_na()`</span> to ensure each level of <span class="in">`gender`</span> is available for each season. We then use <span class="in">`pivot_longer()`</span> to get the data back in a format that will be useful for visualization.  </span>
<span id="cb92-501"><a href="#cb92-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-504"><a href="#cb92-504" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-505"><a href="#cb92-505" aria-hidden="true" tabindex="-1"></a>casts_prop_all <span class="ot">&lt;-</span> casts_gender_count <span class="sc">%&gt;%</span></span>
<span id="cb92-506"><a href="#cb92-506" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sid) <span class="sc">%&gt;%</span></span>
<span id="cb92-507"><a href="#cb92-507" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop=</span>n<span class="sc">/</span><span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb92-508"><a href="#cb92-508" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb92-509"><a href="#cb92-509" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>n) <span class="sc">%&gt;%</span></span>
<span id="cb92-510"><a href="#cb92-510" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> gender,</span>
<span id="cb92-511"><a href="#cb92-511" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> prop) <span class="sc">%&gt;%</span></span>
<span id="cb92-512"><a href="#cb92-512" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(),<span class="sc">~</span><span class="fu">replace_na</span>(.,<span class="dv">0</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb92-513"><a href="#cb92-513" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(female,male,<span class="st">`</span><span class="at">NA</span><span class="st">`</span>,unknown),</span>
<span id="cb92-514"><a href="#cb92-514" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"prop"</span>,</span>
<span id="cb92-515"><a href="#cb92-515" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span>  <span class="st">"gender"</span>) </span>
<span id="cb92-516"><a href="#cb92-516" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-517"><a href="#cb92-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-518"><a href="#cb92-518" aria-hidden="true" tabindex="-1"></a><span class="fu">### Visualizing </span></span>
<span id="cb92-519"><a href="#cb92-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-520"><a href="#cb92-520" aria-hidden="true" tabindex="-1"></a>This first visualization is straightforward. We simply use <span class="in">`geom_path()`</span> to plot a line of the proportion for each gender for each season of Saturday Night Live. </span>
<span id="cb92-521"><a href="#cb92-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-524"><a href="#cb92-524" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-525"><a href="#cb92-525" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(casts_prop_all,<span class="fu">aes</span>(sid,prop,<span class="at">col=</span>gender))<span class="sc">+</span></span>
<span id="cb92-526"><a href="#cb92-526" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>()</span>
<span id="cb92-527"><a href="#cb92-527" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-528"><a href="#cb92-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-529"><a href="#cb92-529" aria-hidden="true" tabindex="-1"></a>The plot looks good, but let's do some more customizing. </span>
<span id="cb92-530"><a href="#cb92-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-533"><a href="#cb92-533" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-534"><a href="#cb92-534" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(casts_prop_all,<span class="fu">aes</span>(sid,prop,<span class="at">col=</span>gender))<span class="sc">+</span></span>
<span id="cb92-535"><a href="#cb92-535" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>()<span class="sc">+</span></span>
<span id="cb92-536"><a href="#cb92-536" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb92-537"><a href="#cb92-537" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name=</span><span class="st">"Gender"</span>)<span class="sc">+</span></span>
<span id="cb92-538"><a href="#cb92-538" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Season"</span>,</span>
<span id="cb92-539"><a href="#cb92-539" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">"Proportion"</span>,</span>
<span id="cb92-540"><a href="#cb92-540" aria-hidden="true" tabindex="-1"></a>       <span class="at">title=</span><span class="st">"Saturday Night Live"</span>,</span>
<span id="cb92-541"><a href="#cb92-541" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle=</span><span class="st">"Gender Makeup by Season"</span>)<span class="sc">+</span></span>
<span id="cb92-542"><a href="#cb92-542" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb92-543"><a href="#cb92-543" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust=</span><span class="fl">0.5</span>),</span>
<span id="cb92-544"><a href="#cb92-544" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle=</span><span class="fu">element_text</span>(<span class="at">hjust=</span><span class="fl">0.5</span>))</span>
<span id="cb92-545"><a href="#cb92-545" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-546"><a href="#cb92-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-547"><a href="#cb92-547" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb92-548"><a href="#cb92-548" aria-hidden="true" tabindex="-1"></a>It looks like over the years, the gender makeup has slowly trended towards equality, but we are far from full equality in SNL.  </span>
<span id="cb92-549"><a href="#cb92-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-550"><a href="#cb92-550" aria-hidden="true" tabindex="-1"></a>One more note: the reader may have a hard time contextualizing these data in terms of "Season Number". It may be more helpful to plot these data in terms of the **YEAR** the season aired. To do that, we need to use <span class="in">`left_join()`</span> to combine our data with the <span class="in">`seasons`</span> dataframe.  </span>
<span id="cb92-551"><a href="#cb92-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-554"><a href="#cb92-554" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-555"><a href="#cb92-555" aria-hidden="true" tabindex="-1"></a>casts_prop_all <span class="sc">%&gt;%</span></span>
<span id="cb92-556"><a href="#cb92-556" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(seasons,<span class="at">by=</span><span class="st">"sid"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-557"><a href="#cb92-557" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(year,prop,<span class="at">col=</span>gender))<span class="sc">+</span></span>
<span id="cb92-558"><a href="#cb92-558" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>()<span class="sc">+</span></span>
<span id="cb92-559"><a href="#cb92-559" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">1975</span>,<span class="dv">2020</span>),</span>
<span id="cb92-560"><a href="#cb92-560" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">1975</span>,<span class="dv">2020</span>,<span class="dv">5</span>))<span class="sc">+</span></span>
<span id="cb92-561"><a href="#cb92-561" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb92-562"><a href="#cb92-562" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name=</span><span class="st">"Gender"</span>)<span class="sc">+</span></span>
<span id="cb92-563"><a href="#cb92-563" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Year"</span>,</span>
<span id="cb92-564"><a href="#cb92-564" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">"Proportion"</span>,</span>
<span id="cb92-565"><a href="#cb92-565" aria-hidden="true" tabindex="-1"></a>       <span class="at">title=</span><span class="st">"Saturday Night Live"</span>,</span>
<span id="cb92-566"><a href="#cb92-566" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle=</span><span class="st">"Gender Makeup by Year"</span>)<span class="sc">+</span></span>
<span id="cb92-567"><a href="#cb92-567" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb92-568"><a href="#cb92-568" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust=</span><span class="fl">0.5</span>),</span>
<span id="cb92-569"><a href="#cb92-569" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle=</span><span class="fu">element_text</span>(<span class="at">hjust=</span><span class="fl">0.5</span>))</span>
<span id="cb92-570"><a href="#cb92-570" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-571"><a href="#cb92-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-572"><a href="#cb92-572" aria-hidden="true" tabindex="-1"></a>That's better. This way, the reader can contextualize the data easier.  </span>
<span id="cb92-573"><a href="#cb92-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-574"><a href="#cb92-574" aria-hidden="true" tabindex="-1"></a><span class="fu">## More analysis/visualization  </span></span>
<span id="cb92-575"><a href="#cb92-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-576"><a href="#cb92-576" aria-hidden="true" tabindex="-1"></a>We might also consider analyzing the male/non-male ratio over the years, to get an idea of the magnitude of gender bias in the way a proportion might not give us. To do so, we use <span class="in">`pivot_wider()`</span>, <span class="in">`mutate()`</span>, <span class="in">`replace_na()`</span>, and <span class="in">`left_join()`</span> again to get a measure of $\frac{male}{nonmale}$ ratio over the years. We again use <span class="in">`geom_path()`</span> to plot this ratio over the years. We also use <span class="in">`geom_hline()`</span> to plot a horizontal line where $\frac{male}{nonmale}$ ratio equals 1.^<span class="co">[</span><span class="ot">Note: A male/non-male ratio of 1 does NOT indicate a lack of gender bias, as the full spectrum of gender is not represented at all in these data. Rather, it indicates a lack of bias in favor of males when compared with the combined sum of all other genders currently available in the data. That is, a value of 1 is not evidence in favor of gender equality in the data.</span><span class="co">]</span></span>
<span id="cb92-577"><a href="#cb92-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-580"><a href="#cb92-580" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-581"><a href="#cb92-581" aria-hidden="true" tabindex="-1"></a>casts_gender_count <span class="sc">%&gt;%</span></span>
<span id="cb92-582"><a href="#cb92-582" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> gender,</span>
<span id="cb92-583"><a href="#cb92-583" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> n) <span class="sc">%&gt;%</span> </span>
<span id="cb92-584"><a href="#cb92-584" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(<span class="st">`</span><span class="at">NA</span><span class="st">`</span>,unknown,male,female),<span class="sc">~</span><span class="fu">replace_na</span>(.,<span class="dv">0</span>)),</span>
<span id="cb92-585"><a href="#cb92-585" aria-hidden="true" tabindex="-1"></a>         <span class="at">male_nonmale_ratio=</span>male<span class="sc">/</span>(female<span class="sc">+</span>unknown<span class="sc">+</span><span class="st">`</span><span class="at">NA</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb92-586"><a href="#cb92-586" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(seasons,<span class="at">by=</span><span class="st">"sid"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-587"><a href="#cb92-587" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(year,male_nonmale_ratio))<span class="sc">+</span></span>
<span id="cb92-588"><a href="#cb92-588" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">col=</span><span class="st">"dodgerblue3"</span>)<span class="sc">+</span></span>
<span id="cb92-589"><a href="#cb92-589" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="dv">1</span>,<span class="at">col=</span><span class="st">"red"</span>,<span class="at">linetype=</span><span class="st">"dashed"</span>)<span class="sc">+</span></span>
<span id="cb92-590"><a href="#cb92-590" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>))<span class="sc">+</span></span>
<span id="cb92-591"><a href="#cb92-591" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Year"</span>,</span>
<span id="cb92-592"><a href="#cb92-592" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">"Male/Non-Male Ratio"</span>,</span>
<span id="cb92-593"><a href="#cb92-593" aria-hidden="true" tabindex="-1"></a>       <span class="at">title=</span><span class="st">"Saturday Night Live"</span>,</span>
<span id="cb92-594"><a href="#cb92-594" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle=</span><span class="st">"Male Bias Over the Years"</span>)<span class="sc">+</span></span>
<span id="cb92-595"><a href="#cb92-595" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb92-596"><a href="#cb92-596" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span><span class="fu">element_text</span>(<span class="at">hjust=</span><span class="fl">0.5</span>),</span>
<span id="cb92-597"><a href="#cb92-597" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle=</span><span class="fu">element_text</span>(<span class="at">hjust=</span><span class="fl">0.5</span>))</span>
<span id="cb92-598"><a href="#cb92-598" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-599"><a href="#cb92-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-600"><a href="#cb92-600" aria-hidden="true" tabindex="-1"></a>Again, it looks like there's been a consistent male bias over the years, which, although trending downward, does not suggest we are at any sort of equality/representation in entertainment.  </span>
<span id="cb92-601"><a href="#cb92-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-602"><a href="#cb92-602" aria-hidden="true" tabindex="-1"></a><span class="fu">## Conclusion  </span></span>
<span id="cb92-603"><a href="#cb92-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-604"><a href="#cb92-604" aria-hidden="true" tabindex="-1"></a>We've managed to put together a relatively straightforward analysis &amp; visualization of the gender makeup of Saturday Night Live over the years. A more complex analysis might also take into account the number of sketches cast members of each gender performed in over the years.</span>
<span id="cb92-605"><a href="#cb92-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-606"><a href="#cb92-606" aria-hidden="true" tabindex="-1"></a>In addition, there are numerous other demographic variables not currently taking into consideration that might provide a more complete analysis of representation in the entertainment industry. </span>
<span id="cb92-607"><a href="#cb92-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-608"><a href="#cb92-608" aria-hidden="true" tabindex="-1"></a>With that being said, this relatively simple analysis is intended to be pedagogical in nature, as a way to demonstrate further some of the helpful data analysis tools available in <span class="in">`dplyr`</span>, <span class="in">`tidyr`</span>, and <span class="in">`ggplot2`</span>. </span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>